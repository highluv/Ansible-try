<!DOCTYPE html>
<html lang="ru">
<head>
  <title>Основы Ansible, без которых ваши плейбуки — комок слипшихся макарон, часть 3 &#x2F; Хабр</title>
<meta property="fb:app_id" content="444736788986613">
<meta property="fb:pages" content="472597926099084">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@habr_com">
<meta property="og:site_name" content="Хабр">
<link href="https://habr.com/ru/rss/publications/512036/?fl=ru" type="application/rss+xml" title rel="alternate" name="rss">
<link href="https://habr.com/ru/articles/512036/" rel="canonical" data-hid="e3fa780">
<link rel="image_src" href="https://habr.com/share/publication/512036/ba04ffcfe726a941a1c87f2a47565775/" data-hid="2a79c45">
<meta property="og:title" content="Основы Ansible, без которых ваши плейбуки — комок слипшихся макарон, часть 3">
<meta name="twitter:title" content="Основы Ansible, без которых ваши плейбуки — комок слипшихся макарон, часть 3">
<meta name="aiturec:title" content="Основы Ansible, без которых ваши плейбуки — комок слипшихся макарон, часть 3">
<meta name="description" content="В этой части мы перестаём говорить о простом и приятном и начинаем говорить о трудном. Переменные в Ansible: scope, precedence, рекурсивная интерполяция. Для тех, кто дочитает до конца, маленький...">
<meta itemprop="description" content="В этой части мы перестаём говорить о простом и приятном и начинаем говорить о трудном. Переменные в Ansible: scope, precedence, рекурсивная интерполяция. Для тех, кто дочитает до конца, маленький...">
<meta property="og:description" content="В этой части мы перестаём говорить о простом и приятном и начинаем говорить о трудном. Переменные в Ansible: scope, precedence, рекурсивная интерполяция. Для тех, кто дочитает до конца, маленький...">
<meta name="twitter:description" content="В этой части мы перестаём говорить о простом и приятном и начинаем говорить о трудном. Переменные в Ansible: scope, precedence, рекурсивная интерполяция. Для тех, кто дочитает до конца, маленький...">
<meta property="aiturec:description" content="В этой части мы перестаём говорить о простом и приятном и начинаем говорить о трудном. Переменные в Ansible: scope, precedence, рекурсивная интерполяция. Для тех, кто дочитает до конца, маленький...">
<meta itemprop="image" content="https://habr.com/share/publication/512036/ba04ffcfe726a941a1c87f2a47565775/">
<meta property="og:image" content="https://habr.com/share/publication/512036/ba04ffcfe726a941a1c87f2a47565775/">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="aiturec:image" content="https://habr.com/share/publication/512036/ba04ffcfe726a941a1c87f2a47565775/">
<meta name="twitter:image" content="https://habr.com/share/publication/512036/ba04ffcfe726a941a1c87f2a47565775/">
<meta property="vk:image" content="https://habr.com/share/publication/512036/ba04ffcfe726a941a1c87f2a47565775/?format=vk">
<meta property="vk:image" content="https://habr.com/share/publication/512036/ba04ffcfe726a941a1c87f2a47565775/?format=vk?format=vk">
<meta property="aiturec:item_id" content="512036">
<meta property="aiturec:datetime" content="2020-07-30T07:30:32.000Z">
<meta content="https://habr.com/ru/articles/512036/" property="og:url">
<meta property="og:type" content="article">
<meta property="og:locale" content="ru_RU">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="keywords" content="ansible, спасибо за чтение, devops">
<script type="application/ld+json" data-hid="1e0f0a2">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/articles\/512036\/"},"headline":"Основы Ansible, без которых ваши плейбуки — комок слипшихся макарон, часть 3","datePublished":"2020-07-30T10:30:32+03:00","dateModified":"2022-02-15T13:23:29+03:00","author":{"@type":"Person","name":"Георгий Шуклин"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"В этой части мы перестаём говорить о простом и приятном и начинаем говорить о трудном. Переменные в Ansible: scope, precedence, рекурсивная интерполяция. Для тех...","url":"https:\/\/habr.com\/ru\/articles\/512036\/#post-content-body","about":["h_linux","h_sys_admin","h_cloud_computing","h_s_admin","h_devops","f_admin"],"image":["https:\/\/habr.com\/share\/publication\/512036\/ba04ffcfe726a941a1c87f2a47565775\/"]}</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,maximum-scale=1,user-scalable=0">
  <meta name="referrer" content="unsafe-url">
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }

    /* non-breaking hyphen */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/l/font?kit=KFOlCnqEu92Fr1MmEU9vBh0_IsHAlmrO6g&skey=ee881451c540fdec&v=v29) format('woff2');
      unicode-range: U+02011;
    }
  </style>
    <link rel="preload" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" as="style" media="(prefers-color-scheme: light)" /><link rel="preload" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" as="style" media="(prefers-color-scheme: dark)" /><link id="light-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" media="(prefers-color-scheme: light)" /><link id="dark-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" media="(prefers-color-scheme: dark)" />
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.591a4d500e5fda8146f0c941231f238e.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.191.0">
  
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
  <script async src="https://unpkg.com/pwacompat" crossorigin="anonymous"></script>
  <script>window.yaContextCb = window.yaContextCb || []</script>
  <script src="https://yandex.ru/ads/system/context.js" async></script>
<link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.19448b30.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.c68fad09.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.f7f953e3.js" as="script"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.c68fad09.css"></head>
<body>

<div id="mount"><div id="app" data-async-called="true"><div class="tm-layout__wrapper"><!--[--><!----><div></div><!----><header class="tm-header" data-test-id="header"><div class="tm-page-width"><!--[--><div class="tm-header__container"><!----><span class="tm-header__logo-wrap"><a class="tm-header__logo tm-header__logo_hl-ru tm-header__logo" href="/ru/"><svg class="tm-svg-img tm-header__icon" height="16" width="16"><title>Хабр</title><use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a><span style="display:none;" class="tm-header__beta-sign">β</span></span><!--[--><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><!--[--><button class="tm-header__dropdown-toggle"><svg class="tm-svg-img tm-header__icon tm-header__icon_dropdown" height="16" width="16"><title>Открыть список</title><use xlink:href="/img/megazord-v28.a580113e..svg#arrow-down"></use></svg></button><!--]--></div><!----></div><a href="/ru/sandbox/start/" class="tm-header__become-author-btn">Как стать автором</a><div class="tm-feature tm-feature tm-feature_variant-inline tm-header__feature"><!----></div><!----><!--]--><!----></div><!--]--></div></header><div class="tm-layout"><div class="tm-page-progress-bar"></div><div class="tm-base-layout__header_is-sticky tm-base-layout__header" data-menu-sticky="true"><div class="tm-page-width"><!--[--><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!--[--><a class="tm-main-menu__item" href="/ru/feed/">Моя лента</a><!--]--><!--[--><a class="tm-main-menu__item" href="/ru/articles/">Все потоки</a><!--]--><!--[--><!--[--><!--[--><a class="tm-main-menu__item" href="/ru/flows/develop/">Разработка</a><!--]--><!--]--><!--[--><!--[--><a class="tm-main-menu__item" href="/ru/flows/admin/">Администрирование</a><!--]--><!--]--><!--[--><!--[--><a class="tm-main-menu__item" href="/ru/flows/design/">Дизайн</a><!--]--><!--]--><!--[--><!--[--><a class="tm-main-menu__item" href="/ru/flows/management/">Менеджмент</a><!--]--><!--]--><!--[--><!--[--><a class="tm-main-menu__item" href="/ru/flows/marketing/">Маркетинг</a><!--]--><!--]--><!--[--><!--[--><a class="tm-main-menu__item" href="/ru/flows/popsci/">Научпоп</a><!--]--><!--]--><!--]--></nav></div></div><div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search" data-test-id="search-button"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark" height="24" width="24"><title>Поиск</title><use xlink:href="/img/megazord-v28.a580113e..svg#search"></use></svg></a><!----><!----><div class="tm-header-user-menu__item tm-header-user-menu__write"><div><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_write tm-header-user-menu__icon_dark" height="24" width="24"><title>Написать публикацию</title><use xlink:href="/img/megazord-v28.a580113e..svg#write"></use></svg></div><!----></div><!--[--><div class="tm-header-user-menu__item"><button class="tm-header-user-menu__toggle" data-test-id="user-menu-settings"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_dark" height="24" width="24"><title>Настройки</title><use xlink:href="/img/megazord-v28.a580113e..svg#page-settings"></use></svg></button></div><a href="https://habr.com/kek/v1/auth/habrahabr/?back=/ru/articles/512036/&amp;hl=ru" rel="nofollow" class="tm-header-user-menu__item"><!--[--><button class="btn btn_solid btn_small tm-header-user-menu__login" type="button"><!--[-->Войти<!--]--></button><!--]--></a><!--]--><!----><!--teleport start--><!--teleport end--><!----></div></div><!--]--></div></div><!----><div class="tm-page-width"><!--[--><!--]--></div><main class="tm-layout__container"><div class="tm-page" hl="ru" data-async-called="true"><div class="tm-page-width"><!--[--><!----><div class="tm-page__wrapper"><div class="tm-page__main_has-sidebar tm-page__main"><div class="pull-down"><!----><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg class="tm-svg-img pull-down__icon pull-down__arrow" height="24" width="24"><title>Обновить</title><use xlink:href="/img/megazord-v28.a580113e..svg#pull-arrow"></use></svg></div></div><!--[--><!--[--><div class="tm-adfox-banner__container"><div id="adfox_169815559787254866" class="tm-adfox-banner tm-adfox-banner_variant-narrow tm-adfox-banner"></div></div><div class="tm-article-presenter"><!--[--><!--]--><div class="tm-article-presenter__body" data-test-id="article-body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><!--[--><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><!--[--><div class="tm-article-presenter__header"><!--[--><!--]--><div class="tm-article-snippet tm-article-snippet tm-article-presenter__snippet"><!--[--><!--]--><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/amarao/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="amarao"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/a4d/28c/40e/a4d28c40e664ad1a3632a3c0a2ca1c72.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/amarao/" class="tm-user-info__username">amarao <!----></a><!--[--><span class="tm-article-datetime-published"><time datetime="2020-07-30T07:30:32.000Z" title="2020-07-30, 10:30">30  июл  2020 в 10:30</time></span><!--]--></span></span></div><!----></div><h1 class="tm-title tm-title_h1" lang="ru" data-test-id="articleTitle"><span>Основы Ansible, без которых ваши плейбуки — комок слипшихся макарон, часть 3</span></h1><div class="tm-article-snippet__stats" data-test-id="articleStats"><!----><div class="tm-article-reading-time"><span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Время на прочтение</title><use xlink:href="/img/megazord-v28.a580113e..svg#clock"></use></svg></span><span class="tm-article-reading-time__label">13 мин</span></div><span class="tm-icon-counter tm-data-icons__item"><svg class="tm-svg-img tm-icon-counter__icon" height="24" width="24"><title>Количество просмотров</title><use xlink:href="/img/megazord-v28.a580113e..svg#counter-views"></use></svg><span class="tm-icon-counter__value">44K</span></span></div><div class="tm-publication-hubs__container" data-test-id="articleHubsList"><div class="tm-publication-hubs"><!--[--><span class="tm-publication-hub__link-container"><a href="/ru/hubs/linux/" class="tm-publication-hub__link"><!--[--><span>Настройка Linux</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/sys_admin/" class="tm-publication-hub__link"><!--[--><span>Системное администрирование</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/cloud_computing/" class="tm-publication-hub__link"><!--[--><span>Облачные вычисления</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/s_admin/" class="tm-publication-hub__link"><!--[--><span>Серверное администрирование</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/devops/" class="tm-publication-hub__link"><!--[--><span>DevOps</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><!--]--></div></div><div class="tm-article-labels" data-test-id="articleLabels"><div class="tm-article-labels__container"><div class="tm-publication-label tm-publication-label_variant-tutorial"><span>Туториал</span></div><!--[--><!--]--></div></div><!----><!----></div></div><!--[--><!----><div class="tm-article-body" data-gallery-root lang="ru"><div><!--[--><!--]--></div><div id="post-content-body"><div><div class="article-formatted-body article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><p>В этой части мы перестаём говорить о простом и приятном и начинаем говорить о трудном. Переменные в Ansible: scope, precedence, рекурсивная интерполяция. Для тех, кто дочитает до конца, маленький бонус: упрощённая таблица приоритетов, с которой можно жить. Предыдущие части: <a href="https://habr.com/en/post/508762/">1</a>, <a href="https://habr.com/en/post/509938/">2</a>.</p><br/>
<p>Обычно рассказ про переменные в Ансибл начинают с чего-то очень простенького, что создаёт у читателя иллюзию, что переменные в Ансибл — это как в любом другом языке программирования. Мутабельные или немутабельные, локальные и глобальные. Это не так.</p><br/>
<p><strong>Это не так.</strong></p><br/>
<p>У Ансибла возникла уникальная модель переменных (модель памяти?), которую надо учить с нуля. И рассматривать мы её начнём с того места, где значения используются (обычно переменные Ансибла рассматривают с того места, откуда они появляются). Почему? Потому что при рассказе в этом направлении у нас образуется направленный граф, который куда легче уложить в голову.</p><br/>
<p>Обратите внимание — я сказал "значения", потому что "переменные" — это всего лишь имена к значениям. У переменных свой глубокий внутренний мир, и про него во второй части.</p><a name="habracut"></a><br/>
<p>В рамках этого рассказа я буду использовать понятия "появляется" и /"используется". Появляется — это то место, где значение было задано. А "попадает" — это то место, где значение начинает влиять на работу Ансибла, точнее, на его сайд-эффекты — на реальный процесс исполнения модулей в целевой системе. Пока переменные перекладываются из места на место в секции <code>vars</code>, значения никуда не "попадают" и на окружающий мир никак не влияют.</p><br/>
<p>Это первая важная мысль, которую надо помнить в голове: пока значение не было использовано чем-то, влияющим на окружающий мир, оно может содержать в себе любые синтаксические ошибки и ссылки на несуществующие переменные и т.д., и это никого не смутит. Почему так — читайте дальше.</p><br/>
<p>Итак, где значения используются?</p><br/>
<ol>
<li>В параметрах к модулю. <code>- copy: src=foo.conf dest=/etc/foo.conf</code>. В этом примере <code>foo.conf</code> и <code>/etc/foo.conf</code> — значения. Они записываются в параметры модуля в целевой системе. В процессе записи, всё, что было в значении, приводится в буквальную форму. Например, на этом этапе вычисляется jinja, числа/строки приводятся к тому формату, который ожидает от них модуль (например, если модуль ожидает строку, а вы передали число, именно на этом этапе Ансибл выдаст предупреждение, что число было сконвертировано в строку).</li>
<li>При выполнении модуля (на самом деле это action plugin) 'template' или соответствующего lookup plugin'а по имени template. Они используют значения из переменных в шаблоне в момент своего исполнения (для lookup plugin когда этот момент наступит совсем не очевидно, потому произойдёт это только когда интерполируется значение, упоминающее этот плагин).</li>
<li>В параметрах play. Любые значения в параметрах play (не путать с переменными уровня play) будут использованы буквально в момент начала play. Например, если у вас jinja2 в <code>gather_facts</code>, то она будет вычислена именно в момент начала выполнения play. Аналогично — <code>hosts</code>, <code>remote_user</code> и другие.</li>
<li>Магические переменные Ансибла, которые влияют на процесс исполнения модуля. В основном, это <code>ansible_host</code>, <code>ansbile_user</code>, <code>ansible_extra_ssh_args</code>, <code>ansible_transport</code> и т.д. Значения из этих переменных вычисляются буквально для каждой таски каждый раз перед выполнением таски.</li>
</ol><br/>
<p>Вооружённые этим знанием мы уже можем попытаться догадываться, что за фигня происходит в этом коде:</p><br/>
<pre><code class="plaintext">- name: Do not do this
  file: path=hello.txt state=touch
  loop: '{{ groups.all }}'
  vars:
     ansible_host: '{{ hostvars[item].ansible_host }}'</code></pre><br/>
<p>Этот ужас обычно невозможно объяснить начинающим. С правильным подходом к понятию "используется" он становится чуть меньшим ужасом (но всё ещё остаётся примером того, как не надо писать).</p><br/>
<p>Что тут происходит?</p><br/>
<ol>
<li>Переменная <code>ansible_host</code> всегда (в пределах этой таски) равна строке <code>{{ hostvars[item].ansible_host }}</code>. Ноль анализа содержимого. Если это валидный yaml, то годится.</li>
<li>Выполняется цикл <code>loop</code>. Цикл <em>использует</em> значение <code>{{ groups.all }}</code>. Это значение — jinja. Производится интерполяция строки, оно и превращается в список имён хостов. loop читает этот список, выполняет таску нужное количество раз, выставляя для каждого запуска таски переменную item в значение "следующий элемент из списка".</li>
<li>Модуль использует значения <code>hello.txt</code> и <code>touch</code>. Ввнутри нет jinja, так что значения остаются просто сами собой.</li>
<li>Перед каждым вызовом модуля <code>file</code> значение переменной <code>ansible_host</code> <em>используется</em> для вычисления буквального параметра для транспорта ssh — куда подключаться. И вот тут вот обнаруживается, что внутри <code>ansible_host</code> находится Jinja, и происходит интерполяция. Каждый раз, когда надо выполнить модуль (т.е. много раз в течение одного loop). Оказывается, что jinja ссылается на переменную item, а её значение разное на каждом проходе цикла (т.е. каждый раз item содержит в себе что-то другое). В результате вычисляется значение, которое <em>используется</em> для подключения для каждого нового прохода цикла. Итог? Извращённая делегация. Не делайте так, но понимайте как оно устроено.</li>
</ol><br/>
<p>Обратите внимание — этот принцип применим ко всем случаям. Например, переменная в инвентори может ссылаться на факт, который будет выставлен где-то далеко в недрах роли. Если значение из этой переменной не будет использовано до выполнения <code>set_fact</code>, то всё ок (кроме здравого смысла), и такое Ансибл съедает без особых проблем.</p><br/>
<p>Это же открывает возможности неявной параметризации. Так, например (и это уже почти best practice) можно задать в групповых переменных IP-адрес для фильтрации:</p><br/>
<pre><code class="plaintext">allow_access: '{{ ansible_default_ipv4.address }}'</code></pre><br/>
<p>При том, что у каждого хоста факты появляются уже в процессе выполнения setup (или gathering_facts), переменная allow_access мирно хранит в себе выражение Jinja до момента, пока не потребуется использовать это значение — и только тогда Ансибл пошевелится выяснить, что же это за переменная такая и чему она равна.</p><br/>
<h1>Jinja</h1><br/>
<p>Второй важный аспект работы Ансибла — это использование Jinja (языка шаблонизации). В подавляющем большинстве случаев все строковые значения, которые используются, проходят через механизм интерполяции (шаблонизации), за вычетом нескольких мест (см ниже). Интерполяция выполняется следующим образом: в каком-то месте ожидается <em>использование</em> строки. Перед использованием строка обрабатывается шаблонизатором. Если шаблонизатор что-то поменял, что получившаяся строка передаётся в шаблонизатор ещё раз. И до тех пор, пока шаблонизатор не перестанет менять строку. После этого строка передаётся в то место, которое его использует (параметр модуля, магическая переменная для запуска модуля и т.д.). Другими словами, шаблонизатор применяет Jinja рекурсивно, пока есть что менять.</p><br/>
<p>Рассмотрим простой пример:</p><br/>
<pre><code class="plaintext">- debug:
     msg: '{{ message }}'
  vars:
    foo: 'foo'
    foobar: '{{ foo + "bar" }}'
    message: 'This is {{ foobar }}' </code></pre><br/>
<p>В момент, когда строковое значение передаётся как параметр 'msg' в модуль 'debug' (это не модуль, а action plugin, но для наших целей это не важно), строка <code>{{ message }}</code> прогоняется через шаблонизатор. Тот видит усы (<code>{{</code> и <code>}}</code>) и заменяет их содержимым переменной message. Получается значение <code>This is {{foobar }}</code>. Дальше это значение прогоняется через шаблонизатор ещё раз получается <code>This is {{ foo + "bar" }}</code>. После ещё одного раунда тест становится <code>This is foobar</code>. После ещё одного раундна интерполяции текст не поменялся, т.е. интерполяция закончена. Получившаяся строка уходит в параметр msg модулю debug.</p><br/>
<p>Въедливый читатель может сказать, что на самом деле это рекурсивная интерполяция, а не циклическая, но с точки зрения рассказа это влияет только на проблемы бесконечной рекурсии.</p><br/>
<p>Теперь поговорим про большое WTF, которое подстерегает любого "программиста на ямле".</p><br/>
<pre><code class="plaintext">- hosts: localhost
  tasks:
    - debug: msg={{foo}}
       vars:
          foo: '{{ foo + 1 }}'
  vars:
     foo: 1</code></pre><br/>
<p>Мне пришлось писать полную play, потому что мне надо было "задать" foo в двух местах. Сначала на уровне play, потом на уровне таски. Что происходит в debug? Он ожидает в msg строку. Эта строка проходит через шаблонизатор, который делает строку <code>{{ foo + 1 }}</code>, потом <code>{{ foo + 1 }} + 1</code> и т.д. Почти мговенно ансибл достигает глубины рекурсии и говорит, что дальше нельзя.</p><br/>
<p>А теперь смотрите на эту магию:</p><br/>
<pre><code class="plaintext">- hosts: localhost
  tasks:
    - set_fact:
         foo: '{{ foo + 1 }}'
     - debug: msg={{foo}}
  vars:
     foo: 1</code></pre><br/>
<p>Этот код выведет число "два"? Почему? Потому что <code>set_fact</code> -это модуль и он использует переменную foo. А ещё он создаёт более приоритетную переменную foo, которая потом и используется. Этот код куда более трудный для понимания, чем кажется, потому что старое foo (со значением 1) никуда не исчезает, просто у новой foo из фактов приоритет выше. Но, об этом в следующем разделе.</p><br/>
<p>Пока что я хочу дать вам интуицию, что как только строка попадает в параметры модуля, она используется. И именно в этот момент происходит интерполяция.</p><br/>
<p>Разберём ещё один пример на развитие интуиции.</p><br/>
<pre><code class="plaintext">- hosts: localhost
  vars:
    foo: '{{ bar * 2 }}'
  tasks:
    - debug: var=foo
      loop: [1,2,3]
      vars:
          bar: '{{ item + 10 }}'</code></pre><br/>
<p>Я специально написал vars для play наверху (иногда так делают для наглядности). Но ещё это докидывает WTF для человека, который не до конца уверен в происходящем.</p><br/>
<p>Что тут случается? Мы делаем итерацию по списку из чисел 1, 2, 3. У нас в таске присутствуют переменные:<br/>
<code>foo</code> со значением <code>'{{ bar * 2 }}'</code> и <code>bar</code> со значением <code>'{{ item + 10 }}'</code>. Обратите внимание, что на этапе vars (как на уровне play, так и на уровне таски), всем (включая ансибл) пофигу, что в этих переменных. Строка и строка. Совершенно не важно, что они "рядом", что они задаются в каком-то специальном порядке.</p><br/>
<p>Важными эти переменные становятся только в момент выполнения модуля debug. Значение foo рекурсивно разворачивается в <code>{{ bar *2 }}</code>, которое разворачивается в <code>{{ (item + 10) * 2 }}</code>. Итоговое значение которое в зависимости от item (меняется loop'ом) становится 22, потом 24, потом 26.</p><br/>
<p>Переменные могут приходить из разных мест — переменные инвентори, переменные групп, дефолты ролей, факты, переменные таск и плейбук и т.д. За вычетом scope/precedence (см ниже), откуда бы ни пришла переменная, она будет подставляться в строку в момент использования строки.</p><br/>
<p>Вот вам ещё один смешной пример:</p><br/>
<pre><code class="plaintext">- hosts: localhost
  vars:
     foo: '{{ bar }}'
  tasks:
    - debug: var=foo
      vars:
         bar: 'one value'
     - debug: var=foo
       vars:
           bar: 'another value'</code></pre><br/>
<p>С учётом вышесказанного точно понятно что происходит. Значение строки используется в момент вызова модуля, происходит рекурсивная интерполяция, в ходе интерполяции используются разные значения bar для первой и второй таски. Mystery solved.</p><br/>
<h1>Блочный Jinja</h1><br/>
<p>Так как все значения параметров для модулей проходят интерполяцию, то шаблоны (точнее, jinja) можно использовать в любых параметрах любых модулей. Можно использовать любую jinja. Не только <code>{{ такую }}</code>, но и <code>{% if True %} "такую" {%endif %}</code>. Что открывает возможность иногда сильно упростить код. В сочетании с многострочными строками yaml это даже читаемо.</p><br/>
<pre><code class="plaintext">- foo_module:
      username: &lt;
           {% for user in myusers %}
                   {% if user.lower() in good and user.upper() in other %}
                          {{ user }}
                    {% endif %}
           {% endfor %}</code></pre><br/>
<p>Ровно тот же метод используется в 'content' для модуля <code>file</code>. На этот раз пример просто копипаст из одного из моих продакшенов:</p><br/>
<pre><code class="plaintext">- name: Configure sfcapd systemd service
  become: true
  copy:
    content: |
      [Unit]
      Description=sflow capture service
      [Service]
      Type=simple
      ExecStart=/usr/bin/sfcapd sfcapd -w -T{{ sflow_extensions }} -p {{ sflow_port }} -B {{ sflow_buffer_size }} -l {{ sflow_data_path }} -b {{ sflow_host }}
      Restart=always
      [Install]
      WantedBy=multi-user.target

    dest: /etc/systemd/system/sfcapd.service
  notify:
    - restart sfcapd</code></pre><br/>
<p>Что мы тут получаем? Экономию человеческого времени на беготне между 100500 файлов в разных каталогах. Файл маленький, тривиальный. Можно <code>template</code>, можно <code>copy</code> с <code>content</code>. Что читаемее, то используем.</p><br/>
<p>Мы почти разобрались со значениями. Осталось три вопроса.</p><br/>
<p>Если вам в какой-то момент времени нужно иметь строку с усами (например, это шаблон prometheus или любого другого приложения на Go), то вы можете запретить интерполяцию строки. Это делается с использованием смеси чёрной yaml-магии и чёрной магии Ансибла.</p><br/>
<p>В Ansible есть два типа строк: safe и unsafe. safe-строки — это обычные строки, которые интерполируются. unsafe строки оставляются как есть и шаблонизатор никогда к ним не прикасается.</p><br/>
<p>Например:</p><br/>
<pre><code class="plaintext">- debug: 
    msg: !unsafe'{{ inventory_hostname }}'</code></pre><br/>
<p>Выведет на экран строку "как есть", то есть <code>{{ inventory_hostname }}</code>.<br/>
Когда я узнал про эту фичу, в моей жизни исчезла большая боль и неудобство.</p><br/>
<p>Второе — когда значения строк интерполируются, а когда нет? Я думал писать список таких случаев, а потом понял, что действует одно простое правило: не интерполируются ключи словарей на любом уровне вложенности ямла. Нельзя использовать шаблоны в именах модулей, ключах словарей в переменных, именах переменных (которые по сути те же ключи).</p><br/>
<h1>Типы</h1><br/>
<p>Я старательно обходил этот вопрос так долго, как можно, потому что теперь из милых странностей Ансибла мы погружаемся в бездны оппортунистической типа-типизации, после которых PHP начинает казаться вершиной теории типов.</p><br/>
<p>Давайте начнём с боевого примера.</p><br/>
<pre><code class="plaintext">---
- hosts: localhost
  gather_facts: false
  tasks:
    - name: Case1
      debug: var=item
      loop: '{{ [1,2,3,4] }}'
    - name: Case2
      debug: var=item
      loop: '{{ foo + bar }}'
    - name: Case3
      debug: var=item
      loop: ' {{ [9,10] }}'
  vars:
    foo: '[5,6'
    bar: '7,8]'</code></pre><br/>
<p>Case1 выглядит как слегка извращённая Jinja без особенностей. Ну да, внутри jinja2 список, мы его выводим. Могли бы так же написать и без усов, а с использованием списков yaml'а.</p><br/>
<p>Case2 должен вызвать первый вопрос от типонаци (типонаци — это как граммарнаци, но с любовью к строгой типизации) — мы взяли две строки, объединили их, но почему-то считаем, что это список. Запахло PHP.</p><br/>
<p>Case3 должен вызвать духовное удовлетворение у типонаци — Ансибл ругается на ошибку, потому что на входе строка вместо списка.</p><br/>
<p>Но комбинация Case2 и Case3 — это то место, где Ансибл Ужасен с большой буквы. Суровая страшная правда жизни состоит в том, что всё, что приходит из переменных Ансибла является строкой в начале. А в конце (перед началом использования) Ансибл пробует это прочитать как json. И если ему удаётся, то он интерпретирует его как получившийся тип (из json'а).</p><br/>
<p>А вот эти два кейса можно считать точкой завершения разумного и предсказуемого в Ansible:</p><br/>
<pre><code class="plaintext">    - name: Case6, space at the end
      debug: var=item
      loop: '{{ [15, 16] }} '
    - name: Case7, space at the start
      debug: var=item
      loop: ' {{ [15, 16] }}'</code></pre><br/>
<p>Case6 работает, потому что в loop список (не смотря на пробел в конце), а Case7 не работает, потому что у него пробел в начале. Почему? Потому. Жри что дали. </p><br/>
<p>… Список таких неочевидных вещей очень большой. Наверное, я потом напишу отдельный пост, состоящий только из WTF'ных автотипизаций ансибла.</p><br/>
<p>Байка: пока я писал этот кусочек, я экспериментировал с разными микросниппетами Ансибла. 5 человек, пищущие на Ансибле для каждого сниппета выдавали разные прогнозы, и ни разу никто не угадал что произойдёт. Я сохранил эти сниппеты для отдельной статьи "хаха, это ансибл". Но поверьте мне, типо-типизация — это жуть.</p><br/>
<p>Основное, что нужно запомнить из этого раздела: настоящими типами обладают только буквальные значения yaml, всё остальное проходит через оппортунистическую типизацию.</p><br/>
<h1>Scope переменных и "слои" переменных</h1><br/>
<p>У переменных Ансибла есть срок жизни. В отличие от типа-"типизации", scope вполне понятен и чаще всего не вызывает вопросов. Перменные Ансибла живут:</p><br/>
<ol>
<li>Вечно, если они заданы в inventory и group_vars.</li>
<li>До окончания play, если заданы в ролях или переменных play. (Вот зачем важно знать, что такое "play" — без этого вы не знаете, как долго ваши переменные существуют).</li>
<li>До окончания task, если это переменные таски.</li>
<li>До окончания плейбуки, если это факт. (именно этим отличаются переменные и факты — факты живут дольше).</li>
</ol><br/>
<p>Я игнорирую модуль <code>include_role</code> в своих рассказах, потому что взаимоотношение сроков жизни и приоритетов переменных для include_role и всего остального настолько запутанно (и меняется от версии к версии), что можно сказать только одно — не используйте include_role. Да и вообще, include любого типа.</p><br/>
<p>Scope на самом деле независимы — переменные в одном scope не заменяют переменные другого scope:</p><br/>
<pre><code class="plaintext">---
- hosts: localhost
  gather_facts: false
  vars:
    foo: 2
  tasks:
    - name: Case1
      debug: var=foo
      vars:
        foo: 1
    - name: Case2
      debug: var=foo</code></pre><br/>
<p>Пока действуют переменные уровня play, вы видите foo=1, как только scope закончился, вы начинаете видеть foo из scope play, где foo равно 2. (Про precedence мы говорим чуть ниже). В нормальном режиме переменные не "появляются" и не "исчезают", они декларативно заданы (и известны в своём неинтерпретированном состоянии до начала выполнения плейбуки). Есть несколько источников "динамических" переменных — <code>include_vars</code>, <code>set_fact</code>, <code>register</code> и т.д.</p><br/>
<h1>Variable precedence</h1><br/>
<p>Это источник невероятных приключений и веселья. Больше веселья доставляет только <code>include_role</code> и типа-"типизация". У Ансибла, если в каком-то месте доступны переменные из нескольких scope, существует набор правил, какие переменные будут использоваться. Эти правила называются variable precedence и это одна из самых плохо сделанных частей Ансибла (что признают даже его разработчики — но исправлять они не могут, потому что любое прикосновение к этой области сломает самым непонятным образом уже написанные плейбуки).</p><br/>
<p>Изначально тезис звучал просто: переменные, приходящие из разных источников имеют разный приоритет. Например, если в инвентори сказано, что <code>http_port: 8088</code>, то это приоритетнее, чем <code>http_port: 80</code> в дефолтах роли. Переменные из комадной строки ансибла <code>-e</code> самые приоритетные и т.д. И всё было бы просто, если бы не путаница с тем, чьи групповые перменные находятся в <code>group_vars/</code>.</p><br/>
<p>Предположим, у вас есть проект, и в каждом файле есть переменная <code>foo</code></p><br/>
<pre><code class="plaintext">inventory.yaml   # [all:vars] foo=inventory
group_vars/all.yaml  # foo: g_v_a
playbook.yaml</code></pre><br/>
<p>У вас есть внутри playbook.yaml таска</p><br/>
<pre><code class="plaintext">- debug: var=foo</code></pre><br/>
<p>Что она выведет?</p><br/>
<p>… Совершенно не важно, сколько вы будете зубрить variable precedence из документации Ансибла, потому что вы не знаете, что такое group_vars тут.</p><br/>
<p>Чтобы разобраться со всем этим, давайте обсудим одну малоизвестную, но критически важную деталь: плагин <code>host_group_vars</code> <a href="https://docs.ansible.com/ansible/latest/plugins/vars/host_group_vars.html" rel="nofollow noopener noreferrer">дока</a>.</p><br/>
<h1>host_group_vars</h1><br/>
<p>В определённые моменты времени (из которых нас интересует момент загрузки инвентори и момент чтения плейбуки) Ансибл запускает плагин host_group_vars. Плагин смотрит в файловую систему в поисках файлов, в которых могут быть group vars или host vars. Он это делает в контексте сущности, для которой делается загрузка. Если group_vars/all.yaml читается в контексте инвентори, то получается переменная инвентори. Если в контексте playbook, получается переменная playbook.</p><br/>
<p>Таким образом, если инвентори и плейбука лежат в одном каталоге, то group_vars читаются ими обоими. Но побеждает тот, кому полагается по variable precedence (playbook), так что содержимое внешних group_vars победит.</p><br/>
<p>Но это ещё не всё. У вас одни и те же group_vars могут быть как снаружи, так и внутри файла инвентори. В этом случае побеждает тот, кто прочитан последний. Сначала читается инвентори, потом данные плагина для этой инвентори, потом следующая инвентори, потом данные плагина второй инвентори и т.д. Потом читаются переменные плейбуки.</p><br/>
<p>На всё это накладывается черезполосица разных приоритетов group_vars/other, group_vars/all, host_vars и т.д. Попытка это всё удержать в голове обычно заканчивается либо ложной картиной мира, либо отчаянием.</p><br/>
<p>Ниже я попробую выписать элементы здравомыслия, которые сложились в моей практике по этому вопросу, но за их пределами — тут нет красивого решения и всюду неожиданности.</p><br/>
<p>При этом приходится писать много переменных в инвентори. Чтобы не провоцировать precedence WTF, есть такое правило: никогда не создавать перекрытие по именам между групповыми переменными (инвентори и плейбук), никогда не создавать перекрытия между hostvars между инвентори и плейбукой.</p><br/>
<h1>Разумная таблица приоритетов</h1><br/>
<p>Примерно такая же, как <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#variable-precedence-where-should-i-put-a-variable" rel="nofollow noopener noreferrer">тут</a>, но без WTF'ов.</p><br/>
<ul>
<li>role/defaults — всегда проигрывает. Идеальное место для размещения переменных, которые надо переопределять. Дефолты ролей видны в соответствующих pre/post tasks.</li>
<li>group_vars/all — переменные группы all наименее приоритетные</li>
<li>group_vars/other_groups</li>
<li>host_vars</li>
<li>результат выполнения gather_facts: true (host_facts)</li>
<li>Переменные уровня play</li>
<li>Переменные уровня block</li>
<li>Переменные уровня task</li>
<li>set_fact/register. <code>set_fact</code> ещё и живёт дольше, чем плей (т.е. может передавать данные между разными play).</li>
<li>-e побеждает всех и всегда.</li>
</ul><br/>
<p>Обратите внимание, что некоторые элементы пропущены (не используйте их). Для каждого уровня запрещены конфликты и "нюансы". Результат куда проще для запоминания и осознания и предсказания.</p><br/>
<p>Пример конфликта: одна и та же переменная в <code>group_vars/all</code> внутри файла инвентори и в файле <code>group_vars/other_group.yaml</code>.</p><br/>
<h1>Динамические чудеса, которые нам в гит попушил матёрый чудак</h1><br/>
<p>Существует множество механизмов для надругательства над переменными, которые не вошли в эти статьи. Несколько видов include'ов (переменных, ролей, тасок), динамические инвентори, возможность делать import из include'а, <code>add_host</code>, позволяющий создавать переменные разного типа на ходу и т.д. Вы можете делать set_fact из делегации. Вы можете создать кастомный модуль, который будет добавлять переменные под видом фактов. Вы можете выставлять переменные уровня jinja, живущие до окончания интерполяции куска строки. Вы можете подгрузить ещё один комплект group_host_vars (плагином) по ходу исполнения play. Вы можете всё это написать, но вы не хотите это ни сопровождать, ни читать.</p><br/>
<p>Keep it clean, keep it simple.</p></div></div></div><!----><!----></div><!----><!----></div><!--]--><!----><div class="tm-article-presenter__meta" data-test-id="article-meta-links"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span><ul class="tm-separated-list__list"><!--[--><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[ansible]" class="tm-tags-list__link"><span>ansible</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D1%81%D0%BF%D0%B0%D1%81%D0%B8%D0%B1%D0%BE+%D0%B7%D0%B0+%D1%87%D1%82%D0%B5%D0%BD%D0%B8%D0%B5]" class="tm-tags-list__link"><span>спасибо за чтение</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[devops]" class="tm-tags-list__link"><span>devops</span></a><!--]--></li><!--]--><!----></ul></div><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span><ul class="tm-separated-list__list"><!--[--><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/linux/" class="tm-hubs-list__link"><!--[--><span>Настройка Linux</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/sys_admin/" class="tm-hubs-list__link"><!--[--><span>Системное администрирование</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/cloud_computing/" class="tm-hubs-list__link"><!--[--><span>Облачные вычисления</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/s_admin/" class="tm-hubs-list__link"><!--[--><span>Серверное администрирование</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/devops/" class="tm-hubs-list__link"><!--[--><span>DevOps</span><!--]--></a><!--]--></li><!--]--><!----></ul></div></div><!----><!--]--></article><!--]--></div><!----></div><div style="" class="tm-article-sticky-panel" data-test-id="article-sticky-panel"><div class="tm-data-icons tm-data-icons tm-data-icons_space-big tm-article-sticky-panel__icons" data-test-id="article-stats-icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon tm-votes-meter__icon_appearance-article" height="24" width="24"><title>Всего голосов 17: ↑16 и ↓1</title><use xlink:href="/img/megazord-v28.a580113e..svg#counter-rating"></use></svg><span class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating tm-votes-meter__value" data-test-id="votes-meter-value" title="Всего голосов 17: ↑16 и ↓1">+21</span></div><!--teleport start--><!--teleport end--><!----></div><!----><!----><button class="bookmarks-button tm-data-icons__item" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.a580113e..svg#counter-favorite"></use></svg></span><span class="bookmarks-button__counter" title="Количество пользователей, добавивших публикацию в закладки">168</span></button><div class="tm-sharing tm-data-icons__item" title="Поделиться"><button class="tm-sharing__button" type="button"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="tm-sharing__icon"><path fill="currentColor" d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z"></path></svg></button><!--teleport start--><!--teleport end--></div><div class="tm-article-comments-counter-link tm-data-icons__item" title="Читать комментарии"><a href="/ru/articles/512036/comments/" class="tm-article-comments-counter-link__link" data-test-id="counter-comments"><!--[--><svg class="tm-svg-img tm-article-comments-counter-link__icon" height="24" width="24"><title>Комментарии</title><use xlink:href="/img/megazord-v28.a580113e..svg#counter-comments"></use></svg><span class="tm-article-comments-counter-link__value">78</span><!--]--></a><!----></div><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--teleport start--><!--teleport end--><!----></div></div></div><!--[--><!--]--><div class="tm-article-presenter__footer"><!--[--><!--[--><div class="tm-article-blocks"><!----><!--[--><section class="tm-block tm-block tm-block_spacing-bottom"><!----><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-balanced"><!--[--><div class="tm-article-author" data-test-id="article-author-info"><!--[--><!--]--><div class="tm-user-card tm-user-card tm-user-card_variant-article tm-article-author__user-card"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/amarao/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" src="//habrastorage.org/getpro/habr/avatars/a4d/28c/40e/a4d28c40e664ad1a3632a3c0a2ca1c72.png"></div></a><div class="tm-user-card__meta"><div class="tm-counter-container tm-karma tm-karma" title=" 2956 голосов "><div class="tm-counter-container__header"><!--[--><div class="tm-karma__votes_positive tm-karma__votes">278</div><!----><!--]--></div><div class="tm-counter-container__footer"><!--[--><div class="tm-karma__text">Карма</div><!--teleport start--><!--teleport end--><!--]--></div></div><div class="tm-counter-container" title="Рейтинг пользователя"><div class="tm-counter-container__header"><!--[--><!--[--><!--]--><div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating"><!----><div class="tm-votes-lever__score tm-votes-lever__score_appearance-rating tm-votes-lever__score"><!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_rating tm-votes-lever__score-counter" data-test-id="votes-score-counter">0</span></span><!--]--></div><!----></div><!--]--></div><div class="tm-counter-container__footer"><!--[--><span class="tm-rating__text tm-rating__text">Рейтинг</span><!--]--></div></div></div></div></div><div class="tm-user-card__info tm-user-card__info_variant-article tm-user-card__info"><div class="tm-user-card__title tm-user-card__title_variant-article tm-user-card__title"><span class="tm-user-card__name tm-user-card__name_variant-article tm-user-card__name">Георгий Шуклин</span><a href="/ru/users/amarao/" class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article"> @amarao</a><!----></div><p class="tm-user-card__short-info tm-user-card__short-info_variant-article tm-user-card__short-info" data-test-id="user-card-speciality">Забанен за упоминание войны. Больше не на хабре.</p></div></div><div class="tm-user-card__buttons tm-user-card__buttons_variant-article tm-user-card__buttons"><!----><div class="tm-user-card__button"><div class="tm-button-follow tm-user-card__button-follow"><!----><button class="tm-button-follow__button tm-button-follow__button_big" data-test-id="follow-button" type="button">Подписаться</button></div></div><!----><div class="tm-user-card__button tm-user-card__button_write" data-test-id="user-card-conversations"><svg class="tm-svg-img tm-user-card__button-icon" height="16" width="16"><title>Отправить сообщение</title><use xlink:href="/img/megazord-v28.a580113e..svg#mail"></use></svg></div><!----></div><!----></div><div class="tm-article-author__user-contacts" data-test-id="author-contacts"><!--[--><a class="tm-article-author__contact" data-test-id="author-contact-link" href="https://medium.com/opsops" rel="noopener" target="_blank">Сайт</a><!--]--></div></div><!--]--></div><!--]--><!----></section><!--[--><div class="tm-adfox-banner__container tm-page-article__banner"><div id="adfox_164725660339535756" class="tm-adfox-banner tm-adfox-banner_variant-leaderboard tm-adfox-banner"></div></div><!--]--><!--]--><div class="tm-article-blocks__comments"><div id="publication-comments" class="tm-article-page-comments"><div><!--[--><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/articles/512036/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style" data-test-id="counter-comments"><!--[--><svg class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted" height="24" width="24"><title>Комментарии</title><use xlink:href="/img/megazord-v28.a580113e..svg#counter-comments"></use></svg><span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted"> Комментарии 78 </span><!--]--></a><!----></div><!--]--></div></div></div><!--[--><!--[--><!--]--><section class="tm-block tm-block tm-block_spacing-bottom"><header class="tm-block__header tm-block__header tm-block__header_variant-borderless"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim"><!--[--><!--[--><div class="tm-tabs tm-tabs"><div class=""><!--[--><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim tm-tabs__tab-link">Лучшие за сутки</button></span><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link_slim tm-tabs__tab-link">Похожие</button></span><!--]--></div><!----></div><div class="similar-and-daily__tab-view"><div class="daily-articles-list"><ul class="tm-article-card-list"><!--[--><!--]--><div class="tm-bordered-card"><!----><!--[--><!--]--></div></ul><div class="daily-articles-block__button-container"><a href="/ru/articles/top/alltime/" class="daily-articles-block__link">Показать лучшие за всё время</a></div></div><!----></div><!--]--><!--]--></div><!--]--><!----></section><!--[--><div><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-promo"><div class="tm-placeholder-promo__header"><div class="tm-placeholder__line tm-placeholder__line_promo-title"></div></div><div class="tm-placeholder-promo__body"><div class="tm-placeholder-promo__posts"><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div></div><div class="tm-placeholder-promo__dots"><div class="tm-placeholder-promo__dot"></div><div class="tm-placeholder-promo__dot"></div><div class="tm-placeholder-promo__dot"></div></div></div></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-inset tm-placeholder-vacancies"><div class="tm-placeholder-inset__header"><div class="tm-placeholder__line tm-placeholder__line_inset-header loads"></div></div><div class="tm-placeholder-inset__body"><ul class="tm-placeholder-list"><!--[--><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><!--]--></ul></div><div class="tm-placeholder-inset__footer"><div class="tm-placeholder__line tm-placeholder__line_inset-footer loads"></div></div></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!--]--><!----><!--[--><!--]--><!--]--></div><!--]--><!--]--></div></div><!--]--><!--]--></div></div><div class="tm-page__sidebar"><!--[--><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__placeholder_initial"></div><div class="tm-sexy-sidebar_initial tm-sexy-sidebar" style="margin-top:0px;"><div class="tm-layout-sidebar__ads_initial tm-layout-sidebar__ads"><div class="tm-adfox-banner__container tm-layout-sidebar__banner tm-layout-sidebar__banner_top"><div id="adfox_164725680533065327" class="tm-adfox-banner tm-adfox-banner_variant-half-page tm-adfox-banner"></div></div></div><!--[--><!----><section class="tm-block tm-block tm-block_spacing-around tm-stories-block" data-navigatable tabindex="0" data-async-called="true"><header class="tm-block__header tm-block__header"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title">Истории</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-equal"><!--[--><div class="tm-stories-empty"><!--[--><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><!--]--></div><!----><!--]--></div><!--]--><!----></section><section class="tm-block tm-block tm-block_spacing-around" data-async-called="true"><header class="tm-block__header tm-block__header"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title">Работа</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body"><!--[--><!--[--><div class="tm-vacancies-block__item"><a class="tm-vacancies-block__vacancy-title" href="https://career.habr.com/vacancies/sistemnij_administrator" target="_blank">Системный администратор</a><div class="tm-vacancies-block__vacancies-count">100
    вакансий</div></div><div class="tm-vacancies-block__item"><a class="tm-vacancies-block__vacancy-title" href="https://career.habr.com/vacancies/devops" target="_blank">DevOps инженер</a><div class="tm-vacancies-block__vacancies-count">50
    вакансий</div></div><!--]--><!--]--></div><!--]--><footer class="tm-block__footer"><!--[--><a class="tm-block-extralink" href="https://career.habr.com/catalog">Все вакансии</a><!--]--></footer></section><section class="tm-block tm-block tm-block_spacing-around block" data-async-called="true" data-v-06d77367><header class="tm-block__header tm-block__header"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title">Ближайшие события</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body"><!--[--><div class="swiper-container slider" style="--swiper-space-between:22px;" data-v-06d77367><div class="swiper-wrapper"><!--[--><!--[--><div class="swiper-slide" data-v-06d77367><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="450" tabindex="-1" data-v-06d77367><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/450/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/d8c/8d5/c5f/d8c8d5c5f2fe3f77b4a21c5e986fceb1.jpg" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/d8c/8d5/c5f/d8c8d5c5f2fe3f77b4a21c5e986fceb1.jpg" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/d8c/8d5/c5f/d8c8d5c5f2fe3f77b4a21c5e986fceb1.jpg, https://habrastorage.org/getpro/habr/upload_files/d8c/8d5/c5f/d8c8d5c5f2fe3f77b4a21c5e986fceb1.jpg 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>29  июля   – 11  августа  </span></div></div><a href="/ru/events/450/" class="tm-event-card__title-link"><span>Аналитики, выбирайте себе компанию по вайбам на Хабр Карьере</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Онлайн</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#450" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-analytics"><span>Аналитика</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><div class="swiper-slide" data-v-06d77367><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="446" tabindex="-1" data-v-06d77367><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/446/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/a54/083/004/a540830046e99800c7174d27aaa791d0.png" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/a54/083/004/a540830046e99800c7174d27aaa791d0.png" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/a54/083/004/a540830046e99800c7174d27aaa791d0.png, https://habrastorage.org/getpro/habr/upload_files/a54/083/004/a540830046e99800c7174d27aaa791d0.png 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>15  августа  </span></div></div><a href="/ru/events/446/" class="tm-event-card__title-link"><span>Бесплатный тест-драйв Хабра для компаний</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Москва</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#446" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-other"><span>Другое</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><div class="swiper-slide" data-v-06d77367><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="444" tabindex="-1" data-v-06d77367><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/444/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/c41/871/91b/c4187191bf4b764e1123113910df83b0.png" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/c41/871/91b/c4187191bf4b764e1123113910df83b0.png" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/c41/871/91b/c4187191bf4b764e1123113910df83b0.png, https://habrastorage.org/getpro/habr/upload_files/c41/871/91b/c4187191bf4b764e1123113910df83b0.png 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>22  августа  </span></div></div><a href="/ru/events/444/" class="tm-event-card__title-link"><span>Летний Хабрасеминар: IT-бренд на пути к сердцу айтишника</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Москва</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#444" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-other"><span>Другое</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><div class="swiper-slide" data-v-06d77367><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="436" tabindex="-1" data-v-06d77367><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/436/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/157/1f9/1ea/1571f91ea5aeb967432a7633aad3a7ae.jpg" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/157/1f9/1ea/1571f91ea5aeb967432a7633aad3a7ae.jpg" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/157/1f9/1ea/1571f91ea5aeb967432a7633aad3a7ae.jpg, https://habrastorage.org/getpro/habr/upload_files/157/1f9/1ea/1571f91ea5aeb967432a7633aad3a7ae.jpg 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>19  сентября  </span></div></div><a href="/ru/events/436/" class="tm-event-card__title-link"><span>CDI Conf 2024</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Москва</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#436" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-marketing"><span>Маркетинг</span></div><div class="event-category__label event-category__label_type-analytics"><span>Аналитика</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><div class="swiper-slide" data-v-06d77367><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="440" tabindex="-1" data-v-06d77367><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/440/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/fd0/255/4d3/fd02554d346912bf8fc4bc81f9406174.png" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/fd0/255/4d3/fd02554d346912bf8fc4bc81f9406174.png" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/fd0/255/4d3/fd02554d346912bf8fc4bc81f9406174.png, https://habrastorage.org/getpro/habr/upload_files/fd0/255/4d3/fd02554d346912bf8fc4bc81f9406174.png 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>24  сентября  </span></div></div><a href="/ru/events/440/" class="tm-event-card__title-link"><span>Конференция Fin.Bot 2024</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Москва</span><span class="tm-event-card__places-separator"> • </span></span><span class="tm-event-card__places-item"><span>Онлайн</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#440" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-development"><span>Разработка</span></div><div class="event-category__label event-category__label_type-management"><span>Менеджмент</span></div><div class="event-category__label event-category__label_type-marketing"><span>Маркетинг</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><div class="swiper-slide" data-v-06d77367><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="448" tabindex="-1" data-v-06d77367><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/448/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/8ca/d72/5e6/8cad725e62dafcc18e20f6e3dd3f2ccd.png" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/8ca/d72/5e6/8cad725e62dafcc18e20f6e3dd3f2ccd.png" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/8ca/d72/5e6/8cad725e62dafcc18e20f6e3dd3f2ccd.png, https://habrastorage.org/getpro/habr/upload_files/8ca/d72/5e6/8cad725e62dafcc18e20f6e3dd3f2ccd.png 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>30  сентября   – 1  октября  </span></div></div><a href="/ru/events/448/" class="tm-event-card__title-link"><span>Конференция фронтенд-разработчиков FrontendConf 2024</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Москва</span><span class="tm-event-card__places-separator"> • </span></span><span class="tm-event-card__places-item"><span>Онлайн</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#448" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-development"><span>Разработка</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><!--]--><!--]--></div><!----><!--[--><button class="swiper-button-prev"><span class="tm-svg-icon__wrapper swiper-button-icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Влево</title><use xlink:href="/img/megazord-v28.a580113e..svg#arrow-back"></use></svg></span></button><button class="swiper-button-next"><span class="tm-svg-icon__wrapper swiper-button-icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Вправо</title><use xlink:href="/img/megazord-v28.a580113e..svg#arrow-back"></use></svg></span></button><!--]--></div><!--]--></div><!--]--><!----></section><!--]--><div class="tm-adfox-banner__container tm-layout-sidebar__banner tm-layout-sidebar__banner_bottom"><div id="adfox_164725691003361602" class="tm-adfox-banner tm-adfox-banner_variant-medium-rectangle tm-adfox-banner"></div></div></div></div><!--]--></div></div><!----><!--]--></div></div></main><!----></div><div class="tm-footer-menu"><div class="tm-page-width"><!--[--><div class="tm-footer-menu__container"><!--[--><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Ваш аккаунт</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/articles/512036/&amp;hl=ru" rel="nofollow" target="_self">Войти</a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/articles/512036/&amp;hl=ru" rel="nofollow" target="_self">Регистрация</a></li><!--]--></ul></div></div><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Разделы</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="/ru/articles/" class="footer-menu__item-link">Статьи</a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">Новости</a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">Хабы</a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">Компании</a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">Авторы</a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">Песочница</a></li><!--]--></ul></div></div><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Информация</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">Устройство сайта</a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">Для авторов</a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">Для компаний</a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">Документы</a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement/?hl=ru_RU" target="_blank">Соглашение</a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/?hl=ru_RU" target="_blank">Конфиденциальность</a></li><!--]--></ul></div></div><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Услуги</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/corporate-blogs/" target="_blank">Корпоративный блог</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/advertising/" target="_blank">Медийная реклама</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/native-special/" target="_blank">Нативные проекты</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/education-programs/" target="_blank">Образовательные программы</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/hello-startup/" target="_blank">Стартапам</a></li><!--]--></ul></div></div><!--]--></div><!--]--></div></div><div class="tm-footer"><div class="tm-page-width"><!--[--><div class="tm-footer__container"><!----><div class="tm-footer__social"><!--[--><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Facebook</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Twitter</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>VK</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-vk"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Telegram</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Youtube</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://dzen.ru/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Яндекс Дзен</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-dzen"></use></svg></a><!--]--></div><!--teleport start--><!--teleport end--><button class="tm-footer__link"><!----> Настройка языка</button><a href="/ru/feedback/" class="tm-footer__link">Техническая поддержка</a><div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2024, </span><span class="tm-copyright__name"><a class="tm-copyright__link" href="https://company.habr.com/" rel="noopener" target="_blank">Habr</a></span></span></div></div><!--]--></div></div><!----><!--]--></div><!----></div><script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"512036":{"id":"512036","timePublished":"2020-07-30T07:30:32+00:00","isCorporative":false,"lang":"ru","titleHtml":"Основы Ansible, без которых ваши плейбуки — комок слипшихся макарон, часть 3","leadData":{"textHtml":"\u003Cp\u003EВ этой части мы перестаём говорить о простом и приятном и начинаем говорить о трудном. Переменные в Ansible: scope, precedence, рекурсивная интерполяция. Для тех, кто дочитает до конца, маленький бонус: упрощённая таблица приоритетов, с которой можно жить. Предыдущие части: \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fen\u002Fpost\u002F508762\u002F\"\u003E1\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fen\u002Fpost\u002F509938\u002F\"\u003E2\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EОбычно рассказ про переменные в Ансибл начинают с чего-то очень простенького, что создаёт у читателя иллюзию, что переменные в Ансибл — это как в любом другом языке программирования. Мутабельные или немутабельные, локальные и глобальные. Это не так.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003E\u003Cstrong\u003EЭто не так.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EУ Ансибла возникла уникальная модель переменных (модель памяти?), которую надо учить с нуля. И рассматривать мы её начнём с того места, где значения используются (обычно переменные Ансибла рассматривают с того места, откуда они появляются). Почему? Потому что при рассказе в этом направлении у нас образуется направленный граф, который куда легче уложить в голову.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EОбратите внимание — я сказал &quot;значения&quot;, потому что &quot;переменные&quot; — это всего лишь имена к значениям. У переменных свой глубокий внутренний мир, и про него во второй части.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"55867","alias":"amarao","fullname":"Георгий Шуклин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa4d\u002F28c\u002F40e\u002Fa4d28c40e664ad1a3632a3c0a2ca1c72.png","speciality":"Забанен за упоминание войны. Больше не на хабре.","scoreStats":{"score":278,"votesCount":2956},"rating":0,"relatedData":null,"contacts":[{"title":"Сайт","url":"https:\u002F\u002Fmedium.com\u002Fopsops","value":"https:\u002F\u002Fmedium.com\u002Fopsops","siteTitle":null,"favicon":null}],"authorContacts":[{"title":"Сайт","url":"https:\u002F\u002Fmedium.com\u002Fopsops","value":"https:\u002F\u002Fmedium.com\u002Fopsops","siteTitle":null,"favicon":null}],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"donationsMethod":null,"isInBlacklist":null},"statistics":{"commentsCount":78,"favoritesCount":168,"readingCount":44171,"score":21,"votesCount":17,"votesCountPlus":16,"votesCountMinus":1},"hubs":[{"id":"36","alias":"linux","type":"collective","title":"Настройка Linux","titleHtml":"Настройка Linux","isProfiled":true,"relatedData":null},{"id":"221","alias":"sys_admin","type":"collective","title":"Системное администрирование","titleHtml":"Системное администрирование","isProfiled":true,"relatedData":null},{"id":"16120","alias":"cloud_computing","type":"collective","title":"Облачные вычисления","titleHtml":"Облачные вычисления","isProfiled":true,"relatedData":null},{"id":"17350","alias":"s_admin","type":"collective","title":"Серверное администрирование","titleHtml":"Серверное администрирование","isProfiled":true,"relatedData":null},{"id":"20788","alias":"devops","type":"collective","title":"DevOps","titleHtml":"DevOps","isProfiled":true,"relatedData":null}],"flows":[{"id":"6","alias":"admin","title":"Администрирование","titleHtml":"Администрирование"}],"relatedData":{"vote":null,"unreadCommentsCount":0,"bookmarked":false,"canComment":false,"canEdit":false,"canViewVotes":false,"votePlus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":true},"voteMinus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":true},"canModerateComments":false,"trackerSubscribed":false,"emailSubscribed":false},"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EВ этой части мы перестаём говорить о простом и приятном и начинаем говорить о трудном. Переменные в Ansible: scope, precedence, рекурсивная интерполяция. Для тех, кто дочитает до конца, маленький бонус: упрощённая таблица приоритетов, с которой можно жить. Предыдущие части: \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fen\u002Fpost\u002F508762\u002F\"\u003E1\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fen\u002Fpost\u002F509938\u002F\"\u003E2\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EОбычно рассказ про переменные в Ансибл начинают с чего-то очень простенького, что создаёт у читателя иллюзию, что переменные в Ансибл — это как в любом другом языке программирования. Мутабельные или немутабельные, локальные и глобальные. Это не так.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cstrong\u003EЭто не так.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EУ Ансибла возникла уникальная модель переменных (модель памяти?), которую надо учить с нуля. И рассматривать мы её начнём с того места, где значения используются (обычно переменные Ансибла рассматривают с того места, откуда они появляются). Почему? Потому что при рассказе в этом направлении у нас образуется направленный граф, который куда легче уложить в голову.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EОбратите внимание — я сказал \"значения\", потому что \"переменные\" — это всего лишь имена к значениям. У переменных свой глубокий внутренний мир, и про него во второй части.\u003C\u002Fp\u003E\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ рамках этого рассказа я буду использовать понятия \"появляется\" и \u002F\"используется\". Появляется — это то место, где значение было задано. А \"попадает\" — это то место, где значение начинает влиять на работу Ансибла, точнее, на его сайд-эффекты — на реальный процесс исполнения модулей в целевой системе. Пока переменные перекладываются из места на место в секции \u003Ccode\u003Evars\u003C\u002Fcode\u003E, значения никуда не \"попадают\" и на окружающий мир никак не влияют.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЭто первая важная мысль, которую надо помнить в голове: пока значение не было использовано чем-то, влияющим на окружающий мир, оно может содержать в себе любые синтаксические ошибки и ссылки на несуществующие переменные и т.д., и это никого не смутит. Почему так — читайте дальше.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EИтак, где значения используются?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EВ параметрах к модулю. \u003Ccode\u003E- copy: src=foo.conf dest=\u002Fetc\u002Ffoo.conf\u003C\u002Fcode\u003E. В этом примере \u003Ccode\u003Efoo.conf\u003C\u002Fcode\u003E и \u003Ccode\u003E\u002Fetc\u002Ffoo.conf\u003C\u002Fcode\u003E — значения. Они записываются в параметры модуля в целевой системе. В процессе записи, всё, что было в значении, приводится в буквальную форму. Например, на этом этапе вычисляется jinja, числа\u002Fстроки приводятся к тому формату, который ожидает от них модуль (например, если модуль ожидает строку, а вы передали число, именно на этом этапе Ансибл выдаст предупреждение, что число было сконвертировано в строку).\u003C\u002Fli\u003E\n\u003Cli\u003EПри выполнении модуля (на самом деле это action plugin) 'template' или соответствующего lookup plugin'а по имени template. Они используют значения из переменных в шаблоне в момент своего исполнения (для lookup plugin когда этот момент наступит совсем не очевидно, потому произойдёт это только когда интерполируется значение, упоминающее этот плагин).\u003C\u002Fli\u003E\n\u003Cli\u003EВ параметрах play. Любые значения в параметрах play (не путать с переменными уровня play) будут использованы буквально в момент начала play. Например, если у вас jinja2 в \u003Ccode\u003Egather_facts\u003C\u002Fcode\u003E, то она будет вычислена именно в момент начала выполнения play. Аналогично — \u003Ccode\u003Ehosts\u003C\u002Fcode\u003E, \u003Ccode\u003Eremote_user\u003C\u002Fcode\u003E и другие.\u003C\u002Fli\u003E\n\u003Cli\u003EМагические переменные Ансибла, которые влияют на процесс исполнения модуля. В основном, это \u003Ccode\u003Eansible_host\u003C\u002Fcode\u003E, \u003Ccode\u003Eansbile_user\u003C\u002Fcode\u003E, \u003Ccode\u003Eansible_extra_ssh_args\u003C\u002Fcode\u003E, \u003Ccode\u003Eansible_transport\u003C\u002Fcode\u003E и т.д. Значения из этих переменных вычисляются буквально для каждой таски каждый раз перед выполнением таски.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВооружённые этим знанием мы уже можем попытаться догадываться, что за фигня происходит в этом коде:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E- name: Do not do this\n  file: path=hello.txt state=touch\n  loop: '{{ groups.all }}'\n  vars:\n     ansible_host: '{{ hostvars[item].ansible_host }}'\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЭтот ужас обычно невозможно объяснить начинающим. С правильным подходом к понятию \"используется\" он становится чуть меньшим ужасом (но всё ещё остаётся примером того, как не надо писать).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЧто тут происходит?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EПеременная \u003Ccode\u003Eansible_host\u003C\u002Fcode\u003E всегда (в пределах этой таски) равна строке \u003Ccode\u003E{{ hostvars[item].ansible_host }}\u003C\u002Fcode\u003E. Ноль анализа содержимого. Если это валидный yaml, то годится.\u003C\u002Fli\u003E\n\u003Cli\u003EВыполняется цикл \u003Ccode\u003Eloop\u003C\u002Fcode\u003E. Цикл \u003Cem\u003Eиспользует\u003C\u002Fem\u003E значение \u003Ccode\u003E{{ groups.all }}\u003C\u002Fcode\u003E. Это значение — jinja. Производится интерполяция строки, оно и превращается в список имён хостов. loop читает этот список, выполняет таску нужное количество раз, выставляя для каждого запуска таски переменную item в значение \"следующий элемент из списка\".\u003C\u002Fli\u003E\n\u003Cli\u003EМодуль использует значения \u003Ccode\u003Ehello.txt\u003C\u002Fcode\u003E и \u003Ccode\u003Etouch\u003C\u002Fcode\u003E. Ввнутри нет jinja, так что значения остаются просто сами собой.\u003C\u002Fli\u003E\n\u003Cli\u003EПеред каждым вызовом модуля \u003Ccode\u003Efile\u003C\u002Fcode\u003E значение переменной \u003Ccode\u003Eansible_host\u003C\u002Fcode\u003E \u003Cem\u003Eиспользуется\u003C\u002Fem\u003E для вычисления буквального параметра для транспорта ssh — куда подключаться. И вот тут вот обнаруживается, что внутри \u003Ccode\u003Eansible_host\u003C\u002Fcode\u003E находится Jinja, и происходит интерполяция. Каждый раз, когда надо выполнить модуль (т.е. много раз в течение одного loop). Оказывается, что jinja ссылается на переменную item, а её значение разное на каждом проходе цикла (т.е. каждый раз item содержит в себе что-то другое). В результате вычисляется значение, которое \u003Cem\u003Eиспользуется\u003C\u002Fem\u003E для подключения для каждого нового прохода цикла. Итог? Извращённая делегация. Не делайте так, но понимайте как оно устроено.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EОбратите внимание — этот принцип применим ко всем случаям. Например, переменная в инвентори может ссылаться на факт, который будет выставлен где-то далеко в недрах роли. Если значение из этой переменной не будет использовано до выполнения \u003Ccode\u003Eset_fact\u003C\u002Fcode\u003E, то всё ок (кроме здравого смысла), и такое Ансибл съедает без особых проблем.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЭто же открывает возможности неявной параметризации. Так, например (и это уже почти best practice) можно задать в групповых переменных IP-адрес для фильтрации:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Eallow_access: '{{ ansible_default_ipv4.address }}'\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПри том, что у каждого хоста факты появляются уже в процессе выполнения setup (или gathering_facts), переменная allow_access мирно хранит в себе выражение Jinja до момента, пока не потребуется использовать это значение — и только тогда Ансибл пошевелится выяснить, что же это за переменная такая и чему она равна.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch1\u003EJinja\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВторой важный аспект работы Ансибла — это использование Jinja (языка шаблонизации). В подавляющем большинстве случаев все строковые значения, которые используются, проходят через механизм интерполяции (шаблонизации), за вычетом нескольких мест (см ниже). Интерполяция выполняется следующим образом: в каком-то месте ожидается \u003Cem\u003Eиспользование\u003C\u002Fem\u003E строки. Перед использованием строка обрабатывается шаблонизатором. Если шаблонизатор что-то поменял, что получившаяся строка передаётся в шаблонизатор ещё раз. И до тех пор, пока шаблонизатор не перестанет менять строку. После этого строка передаётся в то место, которое его использует (параметр модуля, магическая переменная для запуска модуля и т.д.). Другими словами, шаблонизатор применяет Jinja рекурсивно, пока есть что менять.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EРассмотрим простой пример:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E- debug:\n     msg: '{{ message }}'\n  vars:\n    foo: 'foo'\n    foobar: '{{ foo + \"bar\" }}'\n    message: 'This is {{ foobar }}' \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ момент, когда строковое значение передаётся как параметр 'msg' в модуль 'debug' (это не модуль, а action plugin, но для наших целей это не важно), строка \u003Ccode\u003E{{ message }}\u003C\u002Fcode\u003E прогоняется через шаблонизатор. Тот видит усы (\u003Ccode\u003E{{\u003C\u002Fcode\u003E и \u003Ccode\u003E}}\u003C\u002Fcode\u003E) и заменяет их содержимым переменной message. Получается значение \u003Ccode\u003EThis is {{foobar }}\u003C\u002Fcode\u003E. Дальше это значение прогоняется через шаблонизатор ещё раз получается \u003Ccode\u003EThis is {{ foo + \"bar\" }}\u003C\u002Fcode\u003E. После ещё одного раунда тест становится \u003Ccode\u003EThis is foobar\u003C\u002Fcode\u003E. После ещё одного раундна интерполяции текст не поменялся, т.е. интерполяция закончена. Получившаяся строка уходит в параметр msg модулю debug.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВъедливый читатель может сказать, что на самом деле это рекурсивная интерполяция, а не циклическая, но с точки зрения рассказа это влияет только на проблемы бесконечной рекурсии.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EТеперь поговорим про большое WTF, которое подстерегает любого \"программиста на ямле\".\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E- hosts: localhost\n  tasks:\n    - debug: msg={{foo}}\n       vars:\n          foo: '{{ foo + 1 }}'\n  vars:\n     foo: 1\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EМне пришлось писать полную play, потому что мне надо было \"задать\" foo в двух местах. Сначала на уровне play, потом на уровне таски. Что происходит в debug? Он ожидает в msg строку. Эта строка проходит через шаблонизатор, который делает строку \u003Ccode\u003E{{ foo + 1 }}\u003C\u002Fcode\u003E, потом \u003Ccode\u003E{{ foo + 1 }} + 1\u003C\u002Fcode\u003E и т.д. Почти мговенно ансибл достигает глубины рекурсии и говорит, что дальше нельзя.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EА теперь смотрите на эту магию:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E- hosts: localhost\n  tasks:\n    - set_fact:\n         foo: '{{ foo + 1 }}'\n     - debug: msg={{foo}}\n  vars:\n     foo: 1\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЭтот код выведет число \"два\"? Почему? Потому что \u003Ccode\u003Eset_fact\u003C\u002Fcode\u003E -это модуль и он использует переменную foo. А ещё он создаёт более приоритетную переменную foo, которая потом и используется. Этот код куда более трудный для понимания, чем кажется, потому что старое foo (со значением 1) никуда не исчезает, просто у новой foo из фактов приоритет выше. Но, об этом в следующем разделе.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПока что я хочу дать вам интуицию, что как только строка попадает в параметры модуля, она используется. И именно в этот момент происходит интерполяция.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EРазберём ещё один пример на развитие интуиции.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E- hosts: localhost\n  vars:\n    foo: '{{ bar * 2 }}'\n  tasks:\n    - debug: var=foo\n      loop: [1,2,3]\n      vars:\n          bar: '{{ item + 10 }}'\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЯ специально написал vars для play наверху (иногда так делают для наглядности). Но ещё это докидывает WTF для человека, который не до конца уверен в происходящем.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЧто тут случается? Мы делаем итерацию по списку из чисел 1, 2, 3. У нас в таске присутствуют переменные:\u003Cbr\u002F\u003E\n\u003Ccode\u003Efoo\u003C\u002Fcode\u003E со значением \u003Ccode\u003E'{{ bar * 2 }}'\u003C\u002Fcode\u003E и \u003Ccode\u003Ebar\u003C\u002Fcode\u003E со значением \u003Ccode\u003E'{{ item + 10 }}'\u003C\u002Fcode\u003E. Обратите внимание, что на этапе vars (как на уровне play, так и на уровне таски), всем (включая ансибл) пофигу, что в этих переменных. Строка и строка. Совершенно не важно, что они \"рядом\", что они задаются в каком-то специальном порядке.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВажными эти переменные становятся только в момент выполнения модуля debug. Значение foo рекурсивно разворачивается в \u003Ccode\u003E{{ bar *2 }}\u003C\u002Fcode\u003E, которое разворачивается в \u003Ccode\u003E{{ (item + 10) * 2 }}\u003C\u002Fcode\u003E. Итоговое значение которое в зависимости от item (меняется loop'ом) становится 22, потом 24, потом 26.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПеременные могут приходить из разных мест — переменные инвентори, переменные групп, дефолты ролей, факты, переменные таск и плейбук и т.д. За вычетом scope\u002Fprecedence (см ниже), откуда бы ни пришла переменная, она будет подставляться в строку в момент использования строки.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВот вам ещё один смешной пример:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E- hosts: localhost\n  vars:\n     foo: '{{ bar }}'\n  tasks:\n    - debug: var=foo\n      vars:\n         bar: 'one value'\n     - debug: var=foo\n       vars:\n           bar: 'another value'\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EС учётом вышесказанного точно понятно что происходит. Значение строки используется в момент вызова модуля, происходит рекурсивная интерполяция, в ходе интерполяции используются разные значения bar для первой и второй таски. Mystery solved.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch1\u003EБлочный Jinja\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EТак как все значения параметров для модулей проходят интерполяцию, то шаблоны (точнее, jinja) можно использовать в любых параметрах любых модулей. Можно использовать любую jinja. Не только \u003Ccode\u003E{{ такую }}\u003C\u002Fcode\u003E, но и \u003Ccode\u003E{% if True %} \"такую\" {%endif %}\u003C\u002Fcode\u003E. Что открывает возможность иногда сильно упростить код. В сочетании с многострочными строками yaml это даже читаемо.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E- foo_module:\n      username: &lt;\n           {% for user in myusers %}\n                   {% if user.lower() in good and user.upper() in other %}\n                          {{ user }}\n                    {% endif %}\n           {% endfor %}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EРовно тот же метод используется в 'content' для модуля \u003Ccode\u003Efile\u003C\u002Fcode\u003E. На этот раз пример просто копипаст из одного из моих продакшенов:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E- name: Configure sfcapd systemd service\n  become: true\n  copy:\n    content: |\n      [Unit]\n      Description=sflow capture service\n      [Service]\n      Type=simple\n      ExecStart=\u002Fusr\u002Fbin\u002Fsfcapd sfcapd -w -T{{ sflow_extensions }} -p {{ sflow_port }} -B {{ sflow_buffer_size }} -l {{ sflow_data_path }} -b {{ sflow_host }}\n      Restart=always\n      [Install]\n      WantedBy=multi-user.target\n\n    dest: \u002Fetc\u002Fsystemd\u002Fsystem\u002Fsfcapd.service\n  notify:\n    - restart sfcapd\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЧто мы тут получаем? Экономию человеческого времени на беготне между 100500 файлов в разных каталогах. Файл маленький, тривиальный. Можно \u003Ccode\u003Etemplate\u003C\u002Fcode\u003E, можно \u003Ccode\u003Ecopy\u003C\u002Fcode\u003E с \u003Ccode\u003Econtent\u003C\u002Fcode\u003E. Что читаемее, то используем.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EМы почти разобрались со значениями. Осталось три вопроса.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЕсли вам в какой-то момент времени нужно иметь строку с усами (например, это шаблон prometheus или любого другого приложения на Go), то вы можете запретить интерполяцию строки. Это делается с использованием смеси чёрной yaml-магии и чёрной магии Ансибла.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ Ansible есть два типа строк: safe и unsafe. safe-строки — это обычные строки, которые интерполируются. unsafe строки оставляются как есть и шаблонизатор никогда к ним не прикасается.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНапример:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E- debug: \n    msg: !unsafe'{{ inventory_hostname }}'\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВыведет на экран строку \"как есть\", то есть \u003Ccode\u003E{{ inventory_hostname }}\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\nКогда я узнал про эту фичу, в моей жизни исчезла большая боль и неудобство.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВторое — когда значения строк интерполируются, а когда нет? Я думал писать список таких случаев, а потом понял, что действует одно простое правило: не интерполируются ключи словарей на любом уровне вложенности ямла. Нельзя использовать шаблоны в именах модулей, ключах словарей в переменных, именах переменных (которые по сути те же ключи).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch1\u003EТипы\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЯ старательно обходил этот вопрос так долго, как можно, потому что теперь из милых странностей Ансибла мы погружаемся в бездны оппортунистической типа-типизации, после которых PHP начинает казаться вершиной теории типов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EДавайте начнём с боевого примера.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E---\n- hosts: localhost\n  gather_facts: false\n  tasks:\n    - name: Case1\n      debug: var=item\n      loop: '{{ [1,2,3,4] }}'\n    - name: Case2\n      debug: var=item\n      loop: '{{ foo + bar }}'\n    - name: Case3\n      debug: var=item\n      loop: ' {{ [9,10] }}'\n  vars:\n    foo: '[5,6'\n    bar: '7,8]'\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003ECase1 выглядит как слегка извращённая Jinja без особенностей. Ну да, внутри jinja2 список, мы его выводим. Могли бы так же написать и без усов, а с использованием списков yaml'а.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003ECase2 должен вызвать первый вопрос от типонаци (типонаци — это как граммарнаци, но с любовью к строгой типизации) — мы взяли две строки, объединили их, но почему-то считаем, что это список. Запахло PHP.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003ECase3 должен вызвать духовное удовлетворение у типонаци — Ансибл ругается на ошибку, потому что на входе строка вместо списка.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНо комбинация Case2 и Case3 — это то место, где Ансибл Ужасен с большой буквы. Суровая страшная правда жизни состоит в том, что всё, что приходит из переменных Ансибла является строкой в начале. А в конце (перед началом использования) Ансибл пробует это прочитать как json. И если ему удаётся, то он интерпретирует его как получившийся тип (из json'а).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EА вот эти два кейса можно считать точкой завершения разумного и предсказуемого в Ansible:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E    - name: Case6, space at the end\n      debug: var=item\n      loop: '{{ [15, 16] }} '\n    - name: Case7, space at the start\n      debug: var=item\n      loop: ' {{ [15, 16] }}'\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003ECase6 работает, потому что в loop список (не смотря на пробел в конце), а Case7 не работает, потому что у него пробел в начале. Почему? Потому. Жри что дали. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E… Список таких неочевидных вещей очень большой. Наверное, я потом напишу отдельный пост, состоящий только из WTF'ных автотипизаций ансибла.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EБайка: пока я писал этот кусочек, я экспериментировал с разными микросниппетами Ансибла. 5 человек, пищущие на Ансибле для каждого сниппета выдавали разные прогнозы, и ни разу никто не угадал что произойдёт. Я сохранил эти сниппеты для отдельной статьи \"хаха, это ансибл\". Но поверьте мне, типо-типизация — это жуть.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EОсновное, что нужно запомнить из этого раздела: настоящими типами обладают только буквальные значения yaml, всё остальное проходит через оппортунистическую типизацию.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch1\u003EScope переменных и \"слои\" переменных\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EУ переменных Ансибла есть срок жизни. В отличие от типа-\"типизации\", scope вполне понятен и чаще всего не вызывает вопросов. Перменные Ансибла живут:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EВечно, если они заданы в inventory и group_vars.\u003C\u002Fli\u003E\n\u003Cli\u003EДо окончания play, если заданы в ролях или переменных play. (Вот зачем важно знать, что такое \"play\" — без этого вы не знаете, как долго ваши переменные существуют).\u003C\u002Fli\u003E\n\u003Cli\u003EДо окончания task, если это переменные таски.\u003C\u002Fli\u003E\n\u003Cli\u003EДо окончания плейбуки, если это факт. (именно этим отличаются переменные и факты — факты живут дольше).\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЯ игнорирую модуль \u003Ccode\u003Einclude_role\u003C\u002Fcode\u003E в своих рассказах, потому что взаимоотношение сроков жизни и приоритетов переменных для include_role и всего остального настолько запутанно (и меняется от версии к версии), что можно сказать только одно — не используйте include_role. Да и вообще, include любого типа.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EScope на самом деле независимы — переменные в одном scope не заменяют переменные другого scope:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E---\n- hosts: localhost\n  gather_facts: false\n  vars:\n    foo: 2\n  tasks:\n    - name: Case1\n      debug: var=foo\n      vars:\n        foo: 1\n    - name: Case2\n      debug: var=foo\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПока действуют переменные уровня play, вы видите foo=1, как только scope закончился, вы начинаете видеть foo из scope play, где foo равно 2. (Про precedence мы говорим чуть ниже). В нормальном режиме переменные не \"появляются\" и не \"исчезают\", они декларативно заданы (и известны в своём неинтерпретированном состоянии до начала выполнения плейбуки). Есть несколько источников \"динамических\" переменных — \u003Ccode\u003Einclude_vars\u003C\u002Fcode\u003E, \u003Ccode\u003Eset_fact\u003C\u002Fcode\u003E, \u003Ccode\u003Eregister\u003C\u002Fcode\u003E и т.д.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch1\u003EVariable precedence\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЭто источник невероятных приключений и веселья. Больше веселья доставляет только \u003Ccode\u003Einclude_role\u003C\u002Fcode\u003E и типа-\"типизация\". У Ансибла, если в каком-то месте доступны переменные из нескольких scope, существует набор правил, какие переменные будут использоваться. Эти правила называются variable precedence и это одна из самых плохо сделанных частей Ансибла (что признают даже его разработчики — но исправлять они не могут, потому что любое прикосновение к этой области сломает самым непонятным образом уже написанные плейбуки).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EИзначально тезис звучал просто: переменные, приходящие из разных источников имеют разный приоритет. Например, если в инвентори сказано, что \u003Ccode\u003Ehttp_port: 8088\u003C\u002Fcode\u003E, то это приоритетнее, чем \u003Ccode\u003Ehttp_port: 80\u003C\u002Fcode\u003E в дефолтах роли. Переменные из комадной строки ансибла \u003Ccode\u003E-e\u003C\u002Fcode\u003E самые приоритетные и т.д. И всё было бы просто, если бы не путаница с тем, чьи групповые перменные находятся в \u003Ccode\u003Egroup_vars\u002F\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПредположим, у вас есть проект, и в каждом файле есть переменная \u003Ccode\u003Efoo\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Einventory.yaml   # [all:vars] foo=inventory\ngroup_vars\u002Fall.yaml  # foo: g_v_a\nplaybook.yaml\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EУ вас есть внутри playbook.yaml таска\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E- debug: var=foo\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЧто она выведет?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E… Совершенно не важно, сколько вы будете зубрить variable precedence из документации Ансибла, потому что вы не знаете, что такое group_vars тут.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЧтобы разобраться со всем этим, давайте обсудим одну малоизвестную, но критически важную деталь: плагин \u003Ccode\u003Ehost_group_vars\u003C\u002Fcode\u003E \u003Ca href=\"https:\u002F\u002Fdocs.ansible.com\u002Fansible\u002Flatest\u002Fplugins\u002Fvars\u002Fhost_group_vars.html\" rel=\"nofollow noopener noreferrer\"\u003Eдока\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch1\u003Ehost_group_vars\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ определённые моменты времени (из которых нас интересует момент загрузки инвентори и момент чтения плейбуки) Ансибл запускает плагин host_group_vars. Плагин смотрит в файловую систему в поисках файлов, в которых могут быть group vars или host vars. Он это делает в контексте сущности, для которой делается загрузка. Если group_vars\u002Fall.yaml читается в контексте инвентори, то получается переменная инвентори. Если в контексте playbook, получается переменная playbook.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EТаким образом, если инвентори и плейбука лежат в одном каталоге, то group_vars читаются ими обоими. Но побеждает тот, кому полагается по variable precedence (playbook), так что содержимое внешних group_vars победит.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНо это ещё не всё. У вас одни и те же group_vars могут быть как снаружи, так и внутри файла инвентори. В этом случае побеждает тот, кто прочитан последний. Сначала читается инвентори, потом данные плагина для этой инвентори, потом следующая инвентори, потом данные плагина второй инвентори и т.д. Потом читаются переменные плейбуки.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНа всё это накладывается черезполосица разных приоритетов group_vars\u002Fother, group_vars\u002Fall, host_vars и т.д. Попытка это всё удержать в голове обычно заканчивается либо ложной картиной мира, либо отчаянием.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНиже я попробую выписать элементы здравомыслия, которые сложились в моей практике по этому вопросу, но за их пределами — тут нет красивого решения и всюду неожиданности.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПри этом приходится писать много переменных в инвентори. Чтобы не провоцировать precedence WTF, есть такое правило: никогда не создавать перекрытие по именам между групповыми переменными (инвентори и плейбук), никогда не создавать перекрытия между hostvars между инвентори и плейбукой.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch1\u003EРазумная таблица приоритетов\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПримерно такая же, как \u003Ca href=\"https:\u002F\u002Fdocs.ansible.com\u002Fansible\u002Flatest\u002Fuser_guide\u002Fplaybooks_variables.html#variable-precedence-where-should-i-put-a-variable\" rel=\"nofollow noopener noreferrer\"\u003Eтут\u003C\u002Fa\u003E, но без WTF'ов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cul\u003E\n\u003Cli\u003Erole\u002Fdefaults — всегда проигрывает. Идеальное место для размещения переменных, которые надо переопределять. Дефолты ролей видны в соответствующих pre\u002Fpost tasks.\u003C\u002Fli\u003E\n\u003Cli\u003Egroup_vars\u002Fall — переменные группы all наименее приоритетные\u003C\u002Fli\u003E\n\u003Cli\u003Egroup_vars\u002Fother_groups\u003C\u002Fli\u003E\n\u003Cli\u003Ehost_vars\u003C\u002Fli\u003E\n\u003Cli\u003Eрезультат выполнения gather_facts: true (host_facts)\u003C\u002Fli\u003E\n\u003Cli\u003EПеременные уровня play\u003C\u002Fli\u003E\n\u003Cli\u003EПеременные уровня block\u003C\u002Fli\u003E\n\u003Cli\u003EПеременные уровня task\u003C\u002Fli\u003E\n\u003Cli\u003Eset_fact\u002Fregister. \u003Ccode\u003Eset_fact\u003C\u002Fcode\u003E ещё и живёт дольше, чем плей (т.е. может передавать данные между разными play).\u003C\u002Fli\u003E\n\u003Cli\u003E-e побеждает всех и всегда.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EОбратите внимание, что некоторые элементы пропущены (не используйте их). Для каждого уровня запрещены конфликты и \"нюансы\". Результат куда проще для запоминания и осознания и предсказания.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПример конфликта: одна и та же переменная в \u003Ccode\u003Egroup_vars\u002Fall\u003C\u002Fcode\u003E внутри файла инвентори и в файле \u003Ccode\u003Egroup_vars\u002Fother_group.yaml\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch1\u003EДинамические чудеса, которые нам в гит попушил матёрый чудак\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EСуществует множество механизмов для надругательства над переменными, которые не вошли в эти статьи. Несколько видов include'ов (переменных, ролей, тасок), динамические инвентори, возможность делать import из include'а, \u003Ccode\u003Eadd_host\u003C\u002Fcode\u003E, позволяющий создавать переменные разного типа на ходу и т.д. Вы можете делать set_fact из делегации. Вы можете создать кастомный модуль, который будет добавлять переменные под видом фактов. Вы можете выставлять переменные уровня jinja, живущие до окончания интерполяции куска строки. Вы можете подгрузить ещё один комплект group_host_vars (плагином) по ходу исполнения play. Вы можете всё это написать, но вы не хотите это ни сопровождать, ни читать.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EKeep it clean, keep it simple.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"ansible"},{"titleHtml":"спасибо за чтение"},{"titleHtml":"devops"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F512036\u002Fba04ffcfe726a941a1c87f2a47565775\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F512036\u002Fba04ffcfe726a941a1c87f2a47565775\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Farticles\\\u002F512036\\\u002F\"},\"headline\":\"Основы Ansible, без которых ваши плейбуки — комок слипшихся макарон, часть 3\",\"datePublished\":\"2020-07-30T10:30:32+03:00\",\"dateModified\":\"2022-02-15T13:23:29+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Георгий Шуклин\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"В этой части мы перестаём говорить о простом и приятном и начинаем говорить о трудном. Переменные в Ansible: scope, precedence, рекурсивная интерполяция. Для тех...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Farticles\\\u002F512036\\\u002F#post-content-body\",\"about\":[\"h_linux\",\"h_sys_admin\",\"h_cloud_computing\",\"h_s_admin\",\"h_devops\",\"f_admin\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F512036\\\u002Fba04ffcfe726a941a1c87f2a47565775\\\u002F\"]}","metaDescription":"В этой части мы перестаём говорить о простом и приятном и начинаем говорить о трудном. Переменные в Ansible: scope, precedence, рекурсивная интерполяция. Для тех, кто дочитает до конца, маленький...","mainImageUrl":null,"amp":false,"customTrackerLinks":[]},"polls":[],"commentsEnabled":{"status":true,"reason":null},"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"hasPinnedComments":false,"format":"tutorial","banner":null,"multiwidget":null,"readingTime":13,"complexity":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"postReasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"viewedPosts":[],"myFeedFilter":{"complexity":"all","score":"all","types":["articles","posts","news"]},"myFeedIsApplyFilters":false,"myFeedIsForce":false,"karma":{"userReasonsList":null}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[{"title":"Системный администратор","vacanciesCount":100,"itemUrl":"https:\u002F\u002Fcareer.habr.com\u002Fvacancies\u002Fsistemnij_administrator","itemHubs":["s_admin","it-infrastructure","server_side_optimization","sys_admin"]},{"title":"DevOps инженер","vacanciesCount":50,"itemUrl":"https:\u002F\u002Fcareer.habr.com\u002Fvacancies\u002Fdevops","itemHubs":["devops","build_automation","sys_admin","virtualization","kubernetes"]}],"hubs":"linux,sys_admin,cloud_computing,s_admin,devops"},"comments":{"articleComments":{},"articlePinnedComments":{},"searchCommentsResults":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"multiwidgets":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"multiwidgetLoading":false,"vacancies":{},"companiesGalleries":{},"companiesBanners":{},"companiesLandingVacancies":{},"companiesTechnologies":{},"workplaceInfo":null},"companyAdmin":{"companyInfo":null,"companyInfoLoading":false,"faqArticles":null,"brandingPreviewImageUrl":null,"jivoStatus":0,"adminNotifications":null},"companyAdd":{"currentStep":"","stepsData":{},"uncompletedSteps":[],"isStepLoading":true,"isStepCommitting":false,"isInitialized":false,"agreementContent":""},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"pagesCount":0},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":true},"flows":{"flows":[{"alias":"develop","id":"1","route":{"name":"FLOW_PAGE","params":{"flowName":"develop","hl":"ru"}}},{"alias":"admin","id":"6","route":{"name":"FLOW_PAGE","params":{"flowName":"admin","hl":"ru"}}},{"alias":"design","id":"2","route":{"name":"FLOW_PAGE","params":{"flowName":"design","hl":"ru"}}},{"alias":"management","id":"3","route":{"name":"FLOW_PAGE","params":{"flowName":"management","hl":"ru"}}},{"alias":"marketing","id":"4","route":{"name":"FLOW_PAGE","params":{"flowName":"marketing","hl":"ru"}}},{"alias":"popsci","id":"7","route":{"name":"FLOW_PAGE","params":{"flowName":"popsci","hl":"ru"}}}],"updates":{}},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"welcomePage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"query":{},"pathname":"\u002Fru\u002Farticles\u002F512036\u002F","path":"\u002Fru\u002Farticles\u002F512036\u002F","href":"\u002Fru\u002Farticles\u002F512036\u002F"}},"me":{"user":null,"uuid":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null,"userUpdates":{"feeds":{"newPostsCount":null,"newThreadsCount":null,"newNewsCount":null,"newCount":null},"conversationUnreadCount":0}},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{"vacancies":"project-block-article"}},"promoData":{"isLoading":false,"hasLoaded":false,"featurer":null,"megaposts":null,"promoLinks":null,"promoPosts":null},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"search":{"searchQueryError":null},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":true,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"stories":{"stories":[{"id":"story-814","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F339\u002Fa8d\u002F8f1\u002F339a8d8f104e265ca308d72d0dabfddd.png","title":"Хабр Карьера","link":"https:\u002F\u002Fu.habr.com\u002FlqJlx"},"title":"Вас устраивает ваша зарплата?","lang":"ru","startTime":"2024-07-26T00:08:09+03:00","finishTime":"2024-07-31T23:59:00+03:00","slides":[{"id":"story-814_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9e8\u002F8b6\u002F1db\u002F9e88b61db41d2cf1fd74057b39df7ec6.png","button":null},{"id":"story-814_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F939\u002F947\u002F321\u002F9399473212556febea541a4388e4daff.png","button":null},{"id":"story-814_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F16b\u002F5f3\u002F8ed\u002F16b5f38edb2641c9207e72d9e2a17f5e.png","button":null},{"id":"story-814_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1fe\u002Fcbb\u002F1f7\u002F1fecbb1f761dc5f91f4f5147b31aa5c1.png","button":null},{"id":"story-814_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbbe\u002Fe1f\u002F6cd\u002Fbbee1f6cd9072a7117f623e5c55edcf1.png","button":{"title":"Проверить зарплату","link":"https:\u002F\u002Fu.habr.com\u002FlqJlx","colorType":"dark"}}]},{"id":"story-818","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa35\u002F6e7\u002F4a4\u002Fa356e74a4200a23b9c3cfe1dce6b9807.png","title":"Хабр Карьера","link":null},"title":"Как привлекать лучших в IT?","lang":"ru","startTime":"2024-07-25T15:20:00+03:00","finishTime":"2024-08-21T15:20:00+03:00","slides":[{"id":"story-818_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F62e\u002Fd31\u002F3a9\u002F62ed313a993ee1bc7b7a0d8afb4c666f.png","button":null},{"id":"story-818_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F858\u002F122\u002Fd01\u002F858122d017c10025d21fc7e9ae73a8e8.png","button":null},{"id":"story-818_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F790\u002F931\u002F04f\u002F79093104fd7449ca73677566583d1ca9.png","button":{"title":"Смотреть подробности","link":"https:\u002F\u002Fu.habr.com\u002FimD0j","colorType":"dark"}}]},{"id":"story-816","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe3c\u002F59d\u002F329\u002Fe3c59d329afdb78f412449a82174427c.png","title":"Хабр","link":null},"title":"Топ-7 годноты из блогов компаний","lang":"ru","startTime":"2024-07-25T12:15:00+03:00","finishTime":"2024-08-11T12:15:00+03:00","slides":[{"id":"story-816_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8c3\u002Ff69\u002Feb5\u002F8c3f69eb5c35a2e5e3f36ff281411c86.jpg","button":null},{"id":"story-816_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd18\u002F4fc\u002Fcea\u002Fd184fccea565549b71a77876cae64e79.jpg","button":{"title":"Кейс","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fbastion\u002Farticles\u002F829402\u002F","colorType":"light"}},{"id":"story-816_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F89f\u002Fc03\u002F132\u002F89fc03132b2ea70ddeb6e97a97382616.jpg","button":{"title":"Вид изнутри","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fselectel\u002Farticles\u002F828754\u002F","colorType":"light"}},{"id":"story-816_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff86\u002F14d\u002Ffe2\u002Ff8614dfe265d32e4765c49f23bfcebbb.jpg","button":{"title":"Детали","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fods\u002Farticles\u002F828772\u002F","colorType":"light"}},{"id":"story-816_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe47\u002F694\u002F506\u002Fe476945062ae6bca9fd0fb95821722ae.jpg","button":{"title":"Шпионская история","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Ftimeweb\u002Farticles\u002F828794\u002F","colorType":"light"}},{"id":"story-816_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9a4\u002F791\u002F436\u002F9a4791436706a509a491063c6ac64cbf.jpg","button":{"title":"Список литературы","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fyandex_praktikum\u002Farticles\u002F829108\u002F","colorType":"light"}},{"id":"story-816_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F048\u002Fb0f\u002F36b\u002F048b0f36b1c35b23ee39ea2b622d44a0.jpg","button":{"title":"Парадокс","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fruvds\u002Farticles\u002F825010\u002F","colorType":"light"}},{"id":"story-816_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb4f\u002F13b\u002Fd30\u002Fb4f13bd30f53d50721f9c2c0f2e927d4.jpg","button":{"title":"Терминология","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Ftochka\u002Farticles\u002F826152\u002F","colorType":"light"}}]},{"id":"story-812","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6a3\u002Ffaf\u002F087\u002F6a3faf087c5c49e11d08885e044e6f0e.png","title":"Хабр Новости","link":"https:\u002F\u002Fu.habr.com\u002FF63jz"},"title":"Выложен курс по администрированию PostgreSQL","lang":"ru","startTime":"2024-07-23T19:04:00+03:00","finishTime":"2024-07-30T19:04:39+03:00","slides":[{"id":"story-812_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F031\u002Fe83\u002Fe25\u002F031e83e254953744abf6d2f3aa24fa98.jpg","button":{"title":"Узнать больше","link":"https:\u002F\u002Fu.habr.com\u002FF63jz","colorType":"light"}},{"id":"story-812_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa98\u002Fa99\u002Feb4\u002Fa98a99eb4dfd934f97c16909707168a7.jpg","button":null},{"id":"story-812_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0d3\u002F30f\u002F046\u002F0d330f04689535dccb3d7a69d3a237e3.jpg","button":{"title":"Подробности","link":"https:\u002F\u002Fu.habr.com\u002FF63jz","colorType":"dark"}}]},{"id":"story-808","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0b2\u002F8f9\u002F3a0\u002F0b28f93a0a077aaae29a63cb874b41ab.png","title":"Хабр","link":"https:\u002F\u002Fu.habr.com\u002FS5YU4"},"title":"Почему люди бросают курсы","lang":"ru","startTime":"2024-07-19T14:16:00+03:00","finishTime":"2024-07-29T23:59:00+03:00","slides":[{"id":"story-808_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8db\u002F9f4\u002F7ed\u002F8db9f47ed464e49ac63ce103c7872224.jpg","button":null},{"id":"story-808_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff0c\u002F8ea\u002F725\u002Ff0c8ea72525f68789c6ab4e22720be5a.jpg","button":{"title":"Пройти","link":"https:\u002F\u002Fu.habr.com\u002FS5YU4","colorType":"light"}}]},{"id":"story-806","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbc7\u002Fe45\u002F0e4\u002Fbc7e450e4026dfedfc0ad467dc19e275.png","title":"Хабр Карьера","link":null},"title":"Активность найма во 2 квартале 2024","lang":"ru","startTime":"2024-07-17T18:26:00+03:00","finishTime":"2024-07-31T23:59:00+03:00","slides":[{"id":"story-806_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fef7\u002F0d4\u002F06d\u002Fef70d406d0a4eb1bd2bee838bae1ab54.png","button":null},{"id":"story-806_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fda9\u002F979\u002F5c3\u002Fda99795c3bc8e6aeeb849819cc944b91.png","button":null},{"id":"story-806_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fac3\u002F33a\u002Fd32\u002Fac333ad32e8c51dbd61077891d01704c.png","button":null},{"id":"story-806_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F943\u002F7c9\u002Fb99\u002F9437c9b991ca69992d24376822081805.png","button":{"title":"Смотреть","link":"https:\u002F\u002Fu.habr.com\u002FpSVtL","colorType":"dark"}}]},{"id":"story-804","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F383\u002Fedf\u002Fb2d\u002F383edfb2da94faeafcd6f4bdf331b9f8.png","title":"Хабр Карьера","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fusers\u002Fhabr_career\u002Fposts\u002F"},"title":"Зарплаты в IT во первой половине 2024","lang":"ru","startTime":"2024-07-17T15:20:00+03:00","finishTime":"2024-07-31T23:59:00+03:00","slides":[{"id":"story-804_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F070\u002Ff0f\u002F374\u002F070f0f3747f3711950bcb3d5033c7039.png","button":null},{"id":"story-804_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5d9\u002F277\u002F685\u002F5d927768550cdc3e83cb706bc3cd1a88.png","button":null},{"id":"story-804_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F184\u002F1e5\u002F7a0\u002F1841e57a02267e090a818352053d96c8.png","button":null},{"id":"story-804_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F80d\u002Fa6b\u002F420\u002F80da6b42095fe745249c70b1206e0aa3.png","button":null},{"id":"story-804_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fcf6\u002Fa89\u002Fc27\u002Fcf6a89c27f736d2830b5cf72a45a1f12.png","button":{"title":"узнать зарплаты","link":"https:\u002F\u002Fu.habr.com\u002F8d3aW","colorType":"light"}}]}]},"technotext":{"years":[],"technotextDocForNominees":null,"technotextDocForWinners":null,"technotextInfo":{},"technotextInfoLoading":false,"technotextWinners":{},"technotextWinnersLoading":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"userVotes":{"karmaVotesList":[],"karmaVotesPagesCount":null,"karmaVotesListLoading":false,"commentsVotesList":[],"commentsVotesPagesCount":null,"commentsVotesListLoading":false,"postsVotesList":[],"postsVotesPagesCount":null,"postsVotesListLoading":false,"userVotesList":[],"userVotesPagesCount":null,"userVotesListLoading":false},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"userSpecialization":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"notificationsLoading":false,"notificationsList":[],"notificationsPageCount":0,"pendingMarkNotificationsRead":[],"publicationsLoading":true,"publicationsList":[],"publicationsPageCount":0,"pendingDeletePublications":false,"pendingMarkPublicationsRead":false},"events":{"eventRefs":{"436":{"id":"436","titleHtml":"CDI Conf 2024","descriptionHtml":"\u003Cp\u003EПриглашаем на ежегодную конференцию по управлению клиентскими данными. Организатор — IT-компания HFLabs.\u003C\u002Fp\u003E\u003Cp\u003EКонференция посвящена инструментам и&nbsp;возможностям, которые открывает бизнесу грамотная работа с&nbsp;клиентскими данными. Вместе обсудим тренды, вызовы, технологии и&nbsp;подходы, а также нюансы законодательства.\u003C\u002Fp\u003E\u003Cp\u003ECDI Conf 2024 будет интересна специалистам по работе с клиентскими данными из крупных компаний — банков, страховых организаций, ритейла, телекома, букмекерских контор, авиакомпаний и др.\u003C\u002Fp\u003E\u003Cp\u003EВсе доклады — уникальные, готовим их вместе с экспертами из разных компаний специально к CDI Сonf. Ценим ваше время, поэтому все выступления без воды и строго по таймингу.\u003C\u002Fp\u003E\u003Cp\u003EТрадиционно много времени отводим на нетворкинг и даем возможность специалистам из разных компаний обменяться опытом.\u003C\u002Fp\u003E\u003Cp\u003EВ перерывах между докладами работают демозоны, где можно познакомиться с новейшими ИТ-решениями для работы с клиентскими данными.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F157\u002F1f9\u002F1ea\u002F1571f91ea5aeb967432a7633aad3a7ae.jpg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_cdiconf","startDay":"2024-09-19","startTime":"09:00","finishDay":"2024-09-19","finishTime":"15:00","isOnline":false,"geo":["Москва"],"isArchive":false,"categories":[{"id":"10","titleHtml":"Маркетинг"},{"id":"12","titleHtml":"Аналитика"}],"tags":["cdi"],"metadata":null},"440":{"id":"440","titleHtml":"Конференция Fin.Bot 2024","descriptionHtml":"\u003Cp\u003E24 сентября состоится Fin.Bot 2024 — третья профессиональная кейс-конференция о чат-ботах, роботах в голосовых каналах и виртуальных помощниках, а также лучших инструментах создания диалоговых роботов на основе технологий AI, ML и BigData в финансовом секторе.\u003C\u002Fp\u003E\u003Cp\u003EЗадача конференции — собрать экспертизу и кейсы применения чат-ботов, виртуальных помощников и голосовых роботов для решения задач и увеличения эффективности внешних и внутренних бизнес-процессов финансовых организаций.&nbsp;\u003C\u002Fp\u003E\u003Cp\u003EМы поговорим о гибком применении алгоритмов искусственного интеллекта, снижении расходов и оптимизации ресурсов, росте продаж, целевом маркетинге, персонализации, развитии клиентского сервиса, снижении роли человеческого фактора. \u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ffd0\u002F255\u002F4d3\u002Ffd02554d346912bf8fc4bc81f9406174.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_finbot24","startDay":"2024-09-24","startTime":"09:00","isOnline":true,"geo":["Москва"],"isArchive":false,"categories":[{"id":"2","titleHtml":"Разработка"},{"id":"8","titleHtml":"Менеджмент"},{"id":"10","titleHtml":"Маркетинг"}],"tags":["чат-боты","ai","ml","big data"],"metadata":null},"444":{"id":"444","titleHtml":"Летний Хабрасеминар: IT-бренд на пути к сердцу айтишника","descriptionHtml":"\u003Cp\u003EЧто нужно изменить в коммуникациях IT-компаниям, чтобы привлекать лучшие кадры, которые не ищут работу? \u003C\u002Fp\u003E\u003Cp\u003E22 августа Хабр соберет экспертов по коммуникациям с IT-специалистами, чтобы ответить на множество ваших вопросов. Будет полезно как эйчарам, так и маркетологам, а также специалистам по внутренним коммуникациям, которые работают с HR-задачами и брендом работодателя.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc41\u002F871\u002F91b\u002Fc4187191bf4b764e1123113910df83b0.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fhbrsmavg24","startDay":"2024-08-22","startTime":"10:00","finishDay":"2024-08-22","finishTime":"16:00","isOnline":false,"geo":["Москва"],"isArchive":false,"categories":[{"id":"16","titleHtml":"Другое"}],"tags":["хабрасеминар","it-бренд","hr","бренд работодателя"],"metadata":null},"446":{"id":"446","titleHtml":"Бесплатный тест-драйв Хабра для компаний","descriptionHtml":"\u003Cp\u003E15 августа приглашаем тех, кто хочет познакомиться с Хабром получше, на тест-драйв для всех компаний. На ивенте расскажем о том, как компании решают бизнес-задачи с Хабром. Ждем тех, кто хочет узнать про Хабр и «пощупать»‎ его эффект.\u003C\u002Fp\u003E\u003Cp\u003EОбсудим специфику IT-аудитории и контента для неё, а также в дружественной и ламповой атмосфере вместе покреативим. Мы приготовили для вас классную игру, которая погружает в специфику площадки и помогает искать варианты решений ваших задач по привлечению клиентов с помощью Хабра. Будет крутой нетворкинг: можно пообщаться с компаниями-старожилами на Хабре, обменяться опытом.\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa54\u002F083\u002F004\u002Fa540830046e99800c7174d27aaa791d0.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_habrtrial","startDay":"2024-08-15","startTime":"11:00","finishDay":"2024-08-15","finishTime":"16:00","isOnline":false,"geo":["Москва"],"isArchive":false,"categories":[{"id":"16","titleHtml":"Другое"}],"tags":["ивент","хабр","тест-драйв","хабраивент","хабраэффект","клиенты"],"metadata":null},"448":{"id":"448","titleHtml":"Конференция фронтенд-разработчиков FrontendConf 2024","descriptionHtml":"\u003Cp\u003EПриглашаем на FrontendConf 2024 — конференцию фронтенд-разработчиков.\u003C\u002Fp\u003E\u003Cp\u003EЧто вас ждет:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E51 доклад с кейсами, идеями и анализом актуальных задач.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДебаты по актуальным темам отрасли.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EФейл-митап. Важные истории, которые рассказывают без записи и трансляций.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EQA-сессии, общение с экспертами, митапы.&nbsp;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EМасштабный нетворкинг.&nbsp;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EТемы конференции:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EКультура разработки: о вызовах, с которыми сталкиваются лидеры отрасли, и о практиках, которые они применяют.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EАрхитектура: принципы построения масштабируемой архитектуры и подходы к управлению техническим долгом и миграцией кодовой базы.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПроизводительность: о производительных веб-приложениях и о том, как эффективно рендерить изменения и оптимизировать разработку.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EКоммуникации и процессы: об инженерной культуре, которая поможет снизить стоимость разработки и повысить эффективность командной работы.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВнедрение ML: о том, как искусственный интеллект может улучшить продукты и ускорить разработку.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EЖдём вас 30 сентября и 1 октября в Москве.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8ca\u002Fd72\u002F5e6\u002F8cad725e62dafcc18e20f6e3dd3f2ccd.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_frntconf","startDay":"2024-09-30","startTime":"10:00","finishDay":"2024-10-01","finishTime":"20:00","isOnline":true,"geo":["Москва"],"isArchive":false,"categories":[{"id":"2","titleHtml":"Разработка"}],"tags":["frontend","разработка","конференция","ml"],"metadata":null},"450":{"id":"450","titleHtml":"Аналитики, выбирайте себе компанию по вайбам на Хабр Карьере","descriptionHtml":"\u003Cp\u003EНайти команду, в которой атмосфера будет сочетаться со здоровой бюрократией, интересными задачами и хорошей зарплатой — трудно, и сейчас мы не сказали ничего нового. Специалисты с Хабр Карьеры рассказали нам, что хотят знать как можно больше про команду еще до отклика на вакансию.\u003C\u002Fp\u003E\u003Cp\u003EВайб-чек — это что-то вроде онлайн-вечеринки, где можно проверить совместимость ваших вайбов с командами аналитики, в которые прямо сейчас идет наём, поиграть с ними в карьерную настолку, познакомиться ближе и узнать больше, чем написано в вакансиях.\u003C\u002Fp\u003E\u003Cp\u003EРегистрируйтесь, чтобы ничего не пропустить! Начинаем в понедельник, 5 августа.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd8c\u002F8d5\u002Fc5f\u002Fd8c8d5c5f2fe3f77b4a21c5e986fceb1.jpg","eventUrl":"https:\u002F\u002Fvibe.habr.com\u002F?utm_source=vibe_check_analytics_calendar","startDay":"2024-07-29","finishDay":"2024-08-11","isOnline":true,"geo":[],"isArchive":false,"categories":[{"id":"12","titleHtml":"Аналитика"}],"tags":["Карьера в IT-индустрии","Аналитика"],"metadata":null}},"eventIds":["450","446","444","436","440","448"],"pagesCount":1,"categories":[{"id":"2","titleHtml":"Разработка"},{"id":"4","titleHtml":"Администрирование"},{"id":"6","titleHtml":"Дизайн"},{"id":"8","titleHtml":"Менеджмент"},{"id":"10","titleHtml":"Маркетинг"},{"id":"12","titleHtml":"Аналитика"},{"id":"14","titleHtml":"Тестирование"},{"id":"16","titleHtml":"Другое"}],"cities":[{"id":"14","titleHtml":"Белград"},{"id":"16","titleHtml":"Владимир"},{"id":"10","titleHtml":"Екатеринбург"},{"id":"6","titleHtml":"Иннополис"},{"id":"17","titleHtml":"Краснодар"},{"id":"19","titleHtml":"Минск"},{"id":"2","titleHtml":"Москва"},{"id":"8","titleHtml":"Нижний Новгород"},{"id":"12","titleHtml":"Новосибирск"},{"id":"4","titleHtml":"Санкт-Петербург"},{"id":"21","titleHtml":"Ульяновская область"}],"actualEvents":[{"id":"450","titleHtml":"Аналитики, выбирайте себе компанию по вайбам на Хабр Карьере","descriptionHtml":"\u003Cp\u003EНайти команду, в которой атмосфера будет сочетаться со здоровой бюрократией, интересными задачами и хорошей зарплатой — трудно, и сейчас мы не сказали ничего нового. Специалисты с Хабр Карьеры рассказали нам, что хотят знать как можно больше про команду еще до отклика на вакансию.\u003C\u002Fp\u003E\u003Cp\u003EВайб-чек — это что-то вроде онлайн-вечеринки, где можно проверить совместимость ваших вайбов с командами аналитики, в которые прямо сейчас идет наём, поиграть с ними в карьерную настолку, познакомиться ближе и узнать больше, чем написано в вакансиях.\u003C\u002Fp\u003E\u003Cp\u003EРегистрируйтесь, чтобы ничего не пропустить! Начинаем в понедельник, 5 августа.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd8c\u002F8d5\u002Fc5f\u002Fd8c8d5c5f2fe3f77b4a21c5e986fceb1.jpg","eventUrl":"https:\u002F\u002Fvibe.habr.com\u002F?utm_source=vibe_check_analytics_calendar","startDay":"2024-07-29","finishDay":"2024-08-11","isOnline":true,"geo":[],"isArchive":false,"categories":[{"id":"12","titleHtml":"Аналитика"}],"tags":["Карьера в IT-индустрии","Аналитика"],"metadata":null},{"id":"446","titleHtml":"Бесплатный тест-драйв Хабра для компаний","descriptionHtml":"\u003Cp\u003E15 августа приглашаем тех, кто хочет познакомиться с Хабром получше, на тест-драйв для всех компаний. На ивенте расскажем о том, как компании решают бизнес-задачи с Хабром. Ждем тех, кто хочет узнать про Хабр и «пощупать»‎ его эффект.\u003C\u002Fp\u003E\u003Cp\u003EОбсудим специфику IT-аудитории и контента для неё, а также в дружественной и ламповой атмосфере вместе покреативим. Мы приготовили для вас классную игру, которая погружает в специфику площадки и помогает искать варианты решений ваших задач по привлечению клиентов с помощью Хабра. Будет крутой нетворкинг: можно пообщаться с компаниями-старожилами на Хабре, обменяться опытом.\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa54\u002F083\u002F004\u002Fa540830046e99800c7174d27aaa791d0.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_habrtrial","startDay":"2024-08-15","startTime":"11:00","finishDay":"2024-08-15","finishTime":"16:00","isOnline":false,"geo":["Москва"],"isArchive":false,"categories":[{"id":"16","titleHtml":"Другое"}],"tags":["ивент","хабр","тест-драйв","хабраивент","хабраэффект","клиенты"],"metadata":null},{"id":"444","titleHtml":"Летний Хабрасеминар: IT-бренд на пути к сердцу айтишника","descriptionHtml":"\u003Cp\u003EЧто нужно изменить в коммуникациях IT-компаниям, чтобы привлекать лучшие кадры, которые не ищут работу? \u003C\u002Fp\u003E\u003Cp\u003E22 августа Хабр соберет экспертов по коммуникациям с IT-специалистами, чтобы ответить на множество ваших вопросов. Будет полезно как эйчарам, так и маркетологам, а также специалистам по внутренним коммуникациям, которые работают с HR-задачами и брендом работодателя.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc41\u002F871\u002F91b\u002Fc4187191bf4b764e1123113910df83b0.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fhbrsmavg24","startDay":"2024-08-22","startTime":"10:00","finishDay":"2024-08-22","finishTime":"16:00","isOnline":false,"geo":["Москва"],"isArchive":false,"categories":[{"id":"16","titleHtml":"Другое"}],"tags":["хабрасеминар","it-бренд","hr","бренд работодателя"],"metadata":null},{"id":"436","titleHtml":"CDI Conf 2024","descriptionHtml":"\u003Cp\u003EПриглашаем на ежегодную конференцию по управлению клиентскими данными. Организатор — IT-компания HFLabs.\u003C\u002Fp\u003E\u003Cp\u003EКонференция посвящена инструментам и&nbsp;возможностям, которые открывает бизнесу грамотная работа с&nbsp;клиентскими данными. Вместе обсудим тренды, вызовы, технологии и&nbsp;подходы, а также нюансы законодательства.\u003C\u002Fp\u003E\u003Cp\u003ECDI Conf 2024 будет интересна специалистам по работе с клиентскими данными из крупных компаний — банков, страховых организаций, ритейла, телекома, букмекерских контор, авиакомпаний и др.\u003C\u002Fp\u003E\u003Cp\u003EВсе доклады — уникальные, готовим их вместе с экспертами из разных компаний специально к CDI Сonf. Ценим ваше время, поэтому все выступления без воды и строго по таймингу.\u003C\u002Fp\u003E\u003Cp\u003EТрадиционно много времени отводим на нетворкинг и даем возможность специалистам из разных компаний обменяться опытом.\u003C\u002Fp\u003E\u003Cp\u003EВ перерывах между докладами работают демозоны, где можно познакомиться с новейшими ИТ-решениями для работы с клиентскими данными.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F157\u002F1f9\u002F1ea\u002F1571f91ea5aeb967432a7633aad3a7ae.jpg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_cdiconf","startDay":"2024-09-19","startTime":"09:00","finishDay":"2024-09-19","finishTime":"15:00","isOnline":false,"geo":["Москва"],"isArchive":false,"categories":[{"id":"10","titleHtml":"Маркетинг"},{"id":"12","titleHtml":"Аналитика"}],"tags":["cdi"],"metadata":null},{"id":"440","titleHtml":"Конференция Fin.Bot 2024","descriptionHtml":"\u003Cp\u003E24 сентября состоится Fin.Bot 2024 — третья профессиональная кейс-конференция о чат-ботах, роботах в голосовых каналах и виртуальных помощниках, а также лучших инструментах создания диалоговых роботов на основе технологий AI, ML и BigData в финансовом секторе.\u003C\u002Fp\u003E\u003Cp\u003EЗадача конференции — собрать экспертизу и кейсы применения чат-ботов, виртуальных помощников и голосовых роботов для решения задач и увеличения эффективности внешних и внутренних бизнес-процессов финансовых организаций.&nbsp;\u003C\u002Fp\u003E\u003Cp\u003EМы поговорим о гибком применении алгоритмов искусственного интеллекта, снижении расходов и оптимизации ресурсов, росте продаж, целевом маркетинге, персонализации, развитии клиентского сервиса, снижении роли человеческого фактора. \u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ffd0\u002F255\u002F4d3\u002Ffd02554d346912bf8fc4bc81f9406174.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_finbot24","startDay":"2024-09-24","startTime":"09:00","isOnline":true,"geo":["Москва"],"isArchive":false,"categories":[{"id":"2","titleHtml":"Разработка"},{"id":"8","titleHtml":"Менеджмент"},{"id":"10","titleHtml":"Маркетинг"}],"tags":["чат-боты","ai","ml","big data"],"metadata":null},{"id":"448","titleHtml":"Конференция фронтенд-разработчиков FrontendConf 2024","descriptionHtml":"\u003Cp\u003EПриглашаем на FrontendConf 2024 — конференцию фронтенд-разработчиков.\u003C\u002Fp\u003E\u003Cp\u003EЧто вас ждет:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E51 доклад с кейсами, идеями и анализом актуальных задач.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДебаты по актуальным темам отрасли.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EФейл-митап. Важные истории, которые рассказывают без записи и трансляций.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EQA-сессии, общение с экспертами, митапы.&nbsp;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EМасштабный нетворкинг.&nbsp;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EТемы конференции:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EКультура разработки: о вызовах, с которыми сталкиваются лидеры отрасли, и о практиках, которые они применяют.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EАрхитектура: принципы построения масштабируемой архитектуры и подходы к управлению техническим долгом и миграцией кодовой базы.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПроизводительность: о производительных веб-приложениях и о том, как эффективно рендерить изменения и оптимизировать разработку.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EКоммуникации и процессы: об инженерной культуре, которая поможет снизить стоимость разработки и повысить эффективность командной работы.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВнедрение ML: о том, как искусственный интеллект может улучшить продукты и ускорить разработку.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EЖдём вас 30 сентября и 1 октября в Москве.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8ca\u002Fd72\u002F5e6\u002F8cad725e62dafcc18e20f6e3dd3f2ccd.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_frntconf","startDay":"2024-09-30","startTime":"10:00","finishDay":"2024-10-01","finishTime":"20:00","isOnline":true,"geo":["Москва"],"isArchive":false,"categories":[{"id":"2","titleHtml":"Разработка"}],"tags":["frontend","разработка","конференция","ml"],"metadata":null}],"currentEvent":{"id":"436","titleHtml":"CDI Conf 2024","descriptionHtml":"\u003Cp\u003EПриглашаем на ежегодную конференцию по управлению клиентскими данными. Организатор — IT-компания HFLabs.\u003C\u002Fp\u003E\u003Cp\u003EКонференция посвящена инструментам и&nbsp;возможностям, которые открывает бизнесу грамотная работа с&nbsp;клиентскими данными. Вместе обсудим тренды, вызовы, технологии и&nbsp;подходы, а также нюансы законодательства.\u003C\u002Fp\u003E\u003Cp\u003ECDI Conf 2024 будет интересна специалистам по работе с клиентскими данными из крупных компаний — банков, страховых организаций, ритейла, телекома, букмекерских контор, авиакомпаний и др.\u003C\u002Fp\u003E\u003Cp\u003EВсе доклады — уникальные, готовим их вместе с экспертами из разных компаний специально к CDI Сonf. Ценим ваше время, поэтому все выступления без воды и строго по таймингу.\u003C\u002Fp\u003E\u003Cp\u003EТрадиционно много времени отводим на нетворкинг и даем возможность специалистам из разных компаний обменяться опытом.\u003C\u002Fp\u003E\u003Cp\u003EВ перерывах между докладами работают демозоны, где можно познакомиться с новейшими ИТ-решениями для работы с клиентскими данными.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F157\u002F1f9\u002F1ea\u002F1571f91ea5aeb967432a7633aad3a7ae.jpg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_cdiconf","startDay":"2024-09-19","startTime":"09:00","finishDay":"2024-09-19","finishTime":"15:00","isOnline":false,"geo":["Москва"],"isArchive":false,"categories":[{"id":"10","titleHtml":"Маркетинг"},{"id":"12","titleHtml":"Аналитика"}],"tags":["cdi"],"metadata":{"description":"Приглашаем на ежегодную конференцию по управлению клиентскими данными. Организатор — IT-компания HFLabs. Конференция посвящена инструментам и&nbsp;возможностям, которые открывает бизнесу грамотная...","keywords":"cdi"}},"eventsFilter":{"city":"all","timeStarted":null,"timeEnded":null,"pageNum":1}},"wysiwyg":{"WYSIWYGRulesRefs":null},"publicationStatistics":{"statsInfo":{},"statsFunnels":{},"statsGraph":{},"defaultSuggest":{},"suggest":{}},"fixedBanner":{"isArticleStickyPanelVisible":false,"isArticleStickyPanelAtTheBottom":false,"isFixedBannerVisible":false},"onboarding":{"currentStep":null,"stepsData":{"greetings":{"reason":null}},"stepsErrors":{},"completedSteps":[],"isStepCommitting":false,"isCommitDisabled":true}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="https://assets.habr.com/habr-web/js/chunk-vendors.19448b30.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.f7f953e3.js" defer></script></div>
<div id="overlays"><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--></div>


    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S28W1WC23F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
